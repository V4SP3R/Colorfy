<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>COLORFY — COLOR YOUR STYLE</title>
  <meta name="theme-color" content="#6366f1" />
  <!-- Vturb performance preloads -->
  <script>!function (i, n) { i._plt = i._plt || (n && n.timeOrigin ? n.timeOrigin + n.now() : Date.now()) }(window, performance);</script>
  <link rel="preload"
    href="https://scripts.converteai.net/f19c8753-f7c1-411f-b413-7315d568c5f7/players/699505cebb2e3acf42b511e4/v4/player.js"
    as="script">
  <link rel="preload" href="https://scripts.converteai.net/lib/js/smartplayer-wc/v4/smartplayer.js" as="script">
  <link rel="preload"
    href="https://cdn.converteai.net/f19c8753-f7c1-411f-b413-7315d568c5f7/699505be958dc46586dcd3d0/main.m3u8"
    as="fetch">
  <link rel="dns-prefetch" href="https://cdn.converteai.net">
  <link rel="dns-prefetch" href="https://scripts.converteai.net">
  <link rel="dns-prefetch" href="https://images.converteai.net">
  <link rel="dns-prefetch" href="https://api.vturb.com.br">
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Inter:wght@100..900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      /* Base Colors */
      --bg: #ece9e1;
      /* Elegance White/Grey */
      --card: #FFFFFF;
      --text: #1612d3;
      --text-secondary: #555555;
      --muted: #5a687c;

      /* Brand Colors */
      --primary-purple: #782ce7;
      --primary-pink: #0ab6ce;
      --accent-lilac: #F3E8FF;
      --gradient-main: linear-gradient(135deg, #782ce7 0%, #0ab6ce 100%);

      /* Shadows (Premium Glows) */
      --premium-shadow: 0 20px 40px rgba(168, 85, 247, 0.12);
      --glow-btn: 0 10px 25px rgba(217, 70, 239, 0.3);
      --shadow1: rgba(20, 30, 50, .12);
      /* Keep for legacy fallback */
      --shadow2: rgba(255, 255, 255, .9);

      /* Shape & Motion */
      --radius: 28px;
      --radiusSm: 18px;
      --ease: cubic-bezier(0.23, 1, 0.32, 1);
      --t: 400ms;

      /* Legacy/Other Variables */
      --shadowInset1: rgba(20, 30, 50, .15);
      --shadowInset2: rgba(255, 255, 255, .75);
      --brand: #782ce7;
      --brand2: #0ab6ce;
      --brand3: #4f46e5;
      --ok: #2ecb8b;
      --warn: #ffb020;
      --bad: #ff4d5f;
      --focus: 0 0 0 4px rgba(91, 124, 255, .18);
      --glass: rgba(237, 240, 246, .6);
      --glassBorder: rgba(255, 255, 255, .55);
      --font: "Inter", ui-sans-serif, system-ui, -apple-system, sans-serif;
      /* Switched to Inter */
      --scale: 1;
      --contrast: 1;
      --sat: 1;
      --hue: 0deg;
      --blurGlass: 10px;
    }

    html {
      scroll-behavior: smooth;
    }

    /* A11y: reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation: none !important;
        transition: none !important;
        scroll-behavior: auto !important;
      }
    }

    /* ---------- Interaction System ---------- */

    /* Parallax Layers */
    .parallax-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      overflow: hidden;
      pointer-events: none;
    }

    .layer-0 {
      /* Background Gradient */
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 15% 50%, rgba(138, 43, 226, 0.08), transparent 40%),
        radial-gradient(circle at 85% 30%, rgba(217, 70, 239, 0.08), transparent 40%);
      z-index: 0;
    }

    .layer-1 {
      /* Mid Layer - Orbs */
      position: absolute;
      inset: -10%;
      z-index: 1;
      will-change: transform;
    }

    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(120px);
      opacity: 0.6;
    }

    /* Text Reveal Mask */
    .mask-reveal {
      position: relative;
      overflow: hidden;
      display: block;
      /* Ensure block for mask to work on lines */
    }

    .mask-reveal>span {
      display: inline-block;
      transform: translateY(100%);
      opacity: 0;
      animation: revealText 1s cubic-bezier(0.23, 1, 0.32, 1) forwards;
    }

    @keyframes revealText {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Magnetic Button Base */
    .magnet-btn {
      transition: transform 0.2s cubic-bezier(0.23, 1, 0.32, 1);
      will-change: transform;
    }

    /* Liquid Ghost Button */
    .btn-liquid {
      position: relative;
      background: transparent;
      color: var(--primary-purple);
      border: 1.5px solid var(--primary-purple);
      border-radius: 99px;
      font-weight: 700;
      text-transform: uppercase;
      overflow: hidden;
      transition: color 0.4s;
      cursor: pointer;
      z-index: 1;
    }

    .btn-liquid::before {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      width: 150%;
      height: 350%;
      background: var(--primary-purple);
      transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
      transform: translateX(-50%);
      border-radius: 40%;
      z-index: -1;
    }

    .btn-liquid:hover::before {
      top: -40%;
    }

    .btn-liquid:hover {
      color: white;
      box-shadow: var(--glow-btn);
      border-color: transparent;
    }

    /* Premium Card Standard (Neuroaesthetics) */
    .premium-card-standard {
      background: #FFFFFF;
      border-radius: var(--radius);
      padding: 40px;
      border: 1px solid rgba(255, 255, 255, 0.5);
      box-shadow: var(--premium-shadow);
      transition: all 0.5s var(--ease);
    }

    .premium-card-standard:hover {
      box-shadow: 0 40px 80px rgba(138, 43, 226, 0.18);
      border-color: var(--accent-lilac);
      transform: translateY(-4px);
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: var(--font);
      background: radial-gradient(1200px 700px at 20% 10%, rgba(123, 77, 255, .12), transparent 55%),
        radial-gradient(900px 600px at 85% 20%, rgba(255, 74, 162, .11), transparent 60%),
        radial-gradient(900px 600px at 55% 100%, rgba(91, 124, 255, .10), transparent 60%),
        var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;

      transform: scale(var(--scale));
      filter: contrast(var(--contrast)) saturate(var(--sat)) hue-rotate(var(--hue));
      transform-origin: top center;
    }

    /* ---------- Neumorphism 2.0 primitives ---------- */
    .neu-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow:
        20px 20px 40px var(--shadow1),
        -20px -20px 40px var(--shadow2);
      border: 1px solid rgba(255, 255, 255, .15);
    }

    .neu-card.glass {
      background: rgba(255, 255, 255, .7);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border: 1px solid rgba(255, 255, 255, .55);
      box-shadow:
        10px 10px 20px var(--shadow1),
        -10px -10px 20px var(--shadow2);
    }

    .neu-inset {
      background: var(--card);
      border-radius: var(--radiusSm);
      box-shadow:
        inset 10px 10px 18px var(--shadowInset1),
        inset -10px -10px 18px var(--shadowInset2);
      border: 1px solid rgba(255, 255, 255, .35);
    }

    .neu-btn {
      border: 0;
      cursor: pointer;
      padding: 14px 18px;
      border-radius: 999px;
      font-weight: 800;
      letter-spacing: .2px;
      color: var(--text);
      background: var(--card);
      box-shadow:
        10px 10px 20px var(--shadow1),
        -10px -10px 20px var(--shadow2);
      transition: transform var(--t) var(--ease), box-shadow var(--t) var(--ease), filter var(--t) var(--ease);
      position: relative;
      isolation: isolate;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      outline: none;
    }

    .neu-btn:focus-visible {
      box-shadow: var(--focus), 10px 10px 20px var(--shadow1), -10px -10px 20px var(--shadow2);
    }

    .neu-btn:hover {
      transform: translateY(-1px) scale(1.01);
      filter: brightness(1.02);
    }

    .neu-btn:active {
      transform: translateY(0) scale(.995);
      box-shadow:
        inset 10px 10px 18px var(--shadowInset1),
        inset -10px -10px 18px var(--shadowInset2);
    }

    .neu-btn.primary {
      color: #fff;
      background: linear-gradient(135deg, rgba(91, 124, 255, 1), rgba(123, 77, 255, 1), rgba(255, 74, 162, 1));
      box-shadow:
        16px 16px 30px rgba(20, 30, 50, .22),
        -16px -16px 30px rgba(255, 255, 255, .60);
    }

    .neu-btn.primary:hover {
      filter: brightness(1.06) saturate(1.05);
      transform: translateY(-2px) scale(1.02);
    }

    .neu-btn.primary:focus-visible {
      box-shadow: var(--focus), 16px 16px 30px rgba(20, 30, 50, .22), -16px -16px 30px rgba(255, 255, 255, .60);
    }

    .neu-btn.ghost {
      background: transparent;
      box-shadow: none;
      border: 1px solid rgba(255, 255, 255, .55);
      color: var(--muted);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .neu-btn.ghost:hover {
      color: var(--text);
      transform: translateY(-1px);
    }

    .neu-input {
      width: 100%;
      padding: 14px 16px;
      border-radius: 18px;
      border: 0;
      outline: none;
      color: var(--text);
      background: var(--card);
      box-shadow:
        inset 10px 10px 18px var(--shadowInset1),
        inset -10px -10px 18px var(--shadowInset2);
      transition: box-shadow var(--t) var(--ease);
      font-size: 15px;
    }

    .neu-input:focus {
      box-shadow: var(--focus), inset 10px 10px 18px var(--shadowInset1), inset -10px -10px 18px var(--shadowInset2);
    }

    /* Ripple */
    .ripple {
      position: absolute;
      border-radius: 999px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      width: 8px;
      height: 8px;
      background: rgba(255, 255, 255, .35);
      mix-blend-mode: overlay;
      animation: ripple 700ms var(--ease) forwards;
      z-index: -1;
    }

    @keyframes ripple {
      0% {
        opacity: .55;
        transform: translate(-50%, -50%) scale(1);
        filter: blur(0px);
      }

      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(22);
        filter: blur(2px);
      }
    }

    /* ---------- Result Page Premium UI ---------- */
    .premium-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      border-radius: 24px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.6);
      overflow: hidden;
      transition: transform 0.3s ease;
    }

    .premium-card:hover {
      transform: translateY(-2px);
    }

    .glass-panel {
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 16px;
    }

    .reveal-animation {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    }

    .delay-100 {
      animation-delay: 100ms;
    }

    .delay-200 {
      animation-delay: 200ms;
    }

    .delay-300 {
      animation-delay: 300ms;
    }

    .delay-400 {
      animation-delay: 400ms;
    }

    .delay-500 {
      animation-delay: 500ms;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .color-chip {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: 2px solid white;
      transition: transform 0.2s;
    }

    .color-chip:hover {
      transform: scale(1.1);
      z-index: 10;
    }

    .seasonal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
    }

    .seasonal-card {
      padding: 12px;
      border-radius: 16px;
      background: white;
      text-align: center;
      border: 2px solid transparent;
      transition: all 0.3s;
      cursor: pointer;
    }

    .seasonal-card.active {
      border-color: var(--brand);
      box-shadow: 0 8px 24px rgba(91, 124, 255, 0.2);
      transform: scale(1.02);
    }

    /* Checkmark & List Styles */
    .check-list li {
      position: relative;
      padding-left: 28px;
      margin-bottom: 8px;
      color: var(--text);
    }

    .check-list li::before {
      content: "✓";
      position: absolute;
      left: 0;
      color: var(--ok);
      font-weight: bold;
    }

    /* Makeup Icons (Basic SVG placeholders styling) */
    .makeup-icon {
      width: 32px;
      height: 32px;
      background: var(--bg);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
    }

    /* ---------- Layout ---------- */
    .app {
      min-height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: clamp(14px, 2.6vw, 30px);
      padding-bottom: 96px;
      position: relative;
    }

    header.topbar {
      width: min(1100px, 100%);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-top: 6px;
      margin-bottom: 18px;
    }

    header.topbar.centered {
      justify-content: center;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      font-family: "Times New Roman MT Condensed", "Times New Roman", serif;
      font-weight: 700;
      font-size: 28px;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #5b7cff, #ff4aa2);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      padding: 4px 0;
      display: inline-block;
      text-decoration: none;
    }

    /* Garbage base64 below
    background-image: url("data:image/png;base64,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");
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
    box-shadow: 10px 10px 20px rgba(20, 30, 50, .18),
    -10px -10px 20px rgba(255, 255, 255, .65);
    */
    /* Animation for logo shimmer (optional, keeping it) */

    .logo::after {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, .55), transparent 55%);
      animation: shimmer 4.2s var(--ease) infinite;
      transform: rotate(10deg);
    }

    @keyframes shimmer {

      0%,
      100% {
        transform: translateX(-10%) translateY(-10%) rotate(10deg);
        opacity: .55;
      }

      50% {
        transform: translateX(10%) translateY(6%) rotate(10deg);
        opacity: .75;
      }
    }

    .brand h1 {
      font-size: 16px;
      margin: 0;
      letter-spacing: .3px;
    }

    .brand small {
      display: block;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: .6px;
      margin-top: 2px;
      text-transform: uppercase;
      font-size: 11px;
    }

    .logo-img {
      height: 75px;
      width: 90px;
      object-fit: contain;
      display: block;
      /* Optional: subtle shadow if needed, matching text style slightly */
      /* filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); */
    }

    .shell {
      width: min(1100px, 100%);
      position: relative;
    }

    .view-section {
      display: none;
      opacity: 0;
      transform: translateY(12px) scale(.985);
      filter: blur(10px);
      transition: opacity var(--t) var(--ease), transform var(--t) var(--ease), filter var(--t) var(--ease);
    }

    .view-section.active {
      display: block;
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0);
      animation: bounceIn 620ms var(--ease) both;
    }

    .view-section.exit {
      opacity: 0;
      transform: translateY(-8px) scale(1.02);
      filter: blur(10px);
    }

    @keyframes bounceIn {
      0% {
        opacity: 0;
        transform: translateY(14px) scale(.97);
        filter: blur(12px);
      }

      55% {
        opacity: 1;
        transform: translateY(-2px) scale(1.01);
        filter: blur(0);
      }

      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* ---------- Progress ---------- */
    .progressWrap {
      width: min(1100px, 100%);
      margin: 0 0 18px 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .progressBar {
      flex: 1;
      height: 12px;
      border-radius: 999px;
      overflow: hidden;
      position: relative;
    }

    .progressFill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(91, 124, 255, 1), rgba(123, 77, 255, 1), rgba(255, 74, 162, 1));
      border-radius: 999px;
      transition: width 700ms var(--ease);
      position: relative;
    }

    .progressFill::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, .35), transparent);
      transform: translateX(-40%);
      animation: sweep 2.6s var(--ease) infinite;
      opacity: .65;
    }

    @keyframes sweep {
      0% {
        transform: translateX(-45%);
      }

      60% {
        transform: translateX(120%);
      }

      100% {
        transform: translateX(120%);
      }
    }

    .stepLabel {
      min-width: 160px;
      text-align: right;
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
      letter-spacing: .4px;
    }

    /* ---------- Landing ---------- */
    .hero {
      padding: clamp(18px, 2.4vw, 26px);
    }

    .heroTop {
      display: flex;
      gap: 18px;
      align-items: flex-start;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .heroTitle {
      flex: 1 1 520px;
      min-width: min(520px, 100%);
    }

    .heroTitle h2 {
      margin: 0;
      font-size: clamp(34px, 5vw, 56px);
      line-height: 1.02;
      letter-spacing: -1.2px;
      font-family: "Times New Roman MT Condensed", "Times New Roman", serif;
      font-weight: 700;
    }

    .heroTitle h2 .grad {
      background: linear-gradient(90deg, rgba(91, 124, 255, 1), rgba(123, 77, 255, 1), rgba(255, 74, 162, 1));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 8px 30px rgba(91, 124, 255, .12);
    }

    .heroTitle p {
      margin: 20px 0 0;
      color: var(--text);
      /* Darker for better contrast/readability */
      font-weight: 500;
      font-size: clamp(15px, 2.5vw, 17px);
      line-height: 1.6;
      max-width: 54ch;
      opacity: 0.85;
    }

    .ctaRow {
      display: flex;
      gap: 16px;
      flex-wrap: nowrap;
      align-items: center;
      margin-top: 28px;
    }

    /* Pulse Animation for Primary CTA */
    @keyframes pulse-glow {
      0% {
        box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
      }

      70% {
        box-shadow: 0 0 0 10px rgba(99, 102, 241, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
      }
    }

    .pulse-btn {
      animation: pulse-glow 2s infinite;
    }

    .ctaRow .neu-btn.primary {
      padding: 16px 22px;
      font-size: 14px;
      letter-spacing: .6px;
      text-transform: uppercase;
    }

    .socialProof {
      flex: 1 1 320px;
      min-width: min(320px, 100%);
      padding: 16px;
      border-radius: var(--radius);
      position: relative;
      overflow: hidden;
      /* Ensure it aligns with right edge */
      margin-left: auto;
    }

    @media (max-width: 900px) {
      .socialProof {
        flex: 1 1 100%;
        margin-left: 0;
      }
    }

    .socialProof .big {
      font-size: 13px;
      font-weight: 900;
      letter-spacing: .5px;
      margin: 0 0 10px;
    }

    .socialProof .big strong {
      display: block;
      font-size: 16px;
      margin-top: 6px;
      line-height: 1.3;
      color: var(--text);
    }

    .socialProof .proof-desc {
      display: block;
      font-weight: 500;
      color: var(--muted);
      font-size: 13px;
      margin-top: 6px;
      line-height: 1.5;
    }

    .avatars {
      display: flex;
      align-items: center;
      gap: 0;
      margin: 10px 0 8px;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255, 255, 255, .75), rgba(255, 255, 255, .25));
      border: 2px solid rgba(255, 255, 255, .85);
      box-shadow:
        8px 8px 18px rgba(20, 30, 50, .14),
        -8px -8px 18px rgba(255, 255, 255, .72);
      margin-left: -10px;
      position: relative;
      overflow: hidden;
    }

    .avatar:first-child {
      margin-left: 0;
    }

    .avatar::after {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, .7), transparent 55%);
      transform: rotate(12deg);
      opacity: .75;
    }

    .avatarImg {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 999px;
      display: block;
      transform: scale(1.02);
    }

    /* Avatar Reveal & Tooltip */
    .avatars:hover .avatar {
      margin-left: 2px;
      /* Spread effect */
      transform: scale(1.1);
      z-index: 10;
    }

    .avatar[data-tooltip]::before {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(-8px) scale(0.8);
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 10px;
      font-weight: 700;
      color: var(--text);
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s var(--ease);
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .avatar:hover::before {
      opacity: 1;
      transform: translateX(-50%) translateY(-14px) scale(1);
    }

    /* Pulse Stars */
    .stars {
      display: flex;
      gap: 4px;
      align-items: center;
      margin: 8px 0 10px;
    }

    .star {
      width: 16px;
      height: 16px;
      background: conic-gradient(from 0deg, #ffd37a, #ffb020, #ffd37a);
      clip-path: polygon(50% 0%, 62% 32%, 98% 38%, 72% 58%, 80% 92%, 50% 74%, 20% 92%, 28% 58%, 2% 38%, 38% 32%);
      filter: drop-shadow(0 6px 10px rgba(255, 176, 32, .18));
      animation: pulseStar 2s var(--ease) infinite;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .star:hover {
      transform: scale(1.3) rotate(15deg);
    }

    .star:active {
      transform: scale(0.9);
    }

    @keyframes pulseStar {

      0%,
      100% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.15);
        opacity: 0.8;
      }
    }

    .socialProof .quote {
      margin: 0;
      color: var(--muted);
      font-weight: 750;
      font-size: 13px;
      line-height: 1.45;
    }



    .star:nth-child(2) {
      animation-delay: .2s;
    }

    .star:nth-child(3) {
      animation-delay: .4s;
    }

    .star:nth-child(4) {
      animation-delay: .6s;
    }

    .star:nth-child(5) {
      animation-delay: .8s;
    }

    @keyframes twinkle {

      0%,
      100% {
        transform: translateY(0) scale(1);
        opacity: .95;
      }

      50% {
        transform: translateY(-1px) scale(1.03);
        opacity: 1;
      }
    }

    .socialProof .quote {
      margin: 0;
      color: var(--muted);
      font-weight: 750;
      font-size: 13px;
      line-height: 1.45;
    }

    .flowGrid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
      margin-top: 18px;
    }

    @media (max-width: 860px) {
      .flowGrid {
        grid-template-columns: 1fr;
      }

      .stepLabel {
        min-width: 120px;
      }
    }

    /* Flow Card Interactions */
    .flowCard {
      padding: 16px;
      border-radius: var(--radius);
      position: relative;
      overflow: hidden;
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.6s var(--ease), transform 0.6s var(--ease), border-color 0.4s, box-shadow 0.4s;
    }

    .flowCard.in-view {
      opacity: 1;
      transform: translateY(0);
    }

    .flowCard.focused {
      border-color: var(--primary-purple);
      box-shadow: 0 12px 30px rgba(138, 43, 226, 0.15);
      transform: scale(1.02);
      z-index: 2;
      opacity: 1;
    }

    .flowCard.blurred {
      opacity: 0.6;
      transform: scale(0.98);
      filter: grayscale(0.4);
    }

    .flowCard .icon {
      width: 44px;
      height: 44px;
      border-radius: 16px;
      display: grid;
      place-items: center;
      margin-bottom: 10px;
      background: linear-gradient(135deg, rgba(255, 255, 255, .55), rgba(255, 255, 255, .22));
      border: 1px solid rgba(255, 255, 255, .55);
      box-shadow:
        12px 12px 22px rgba(20, 30, 50, .14),
        -12px -12px 22px rgba(255, 255, 255, .72);
    }

    /* Icon Animations */
    .icon-upload {
      animation: floaty 3s ease-in-out infinite;
    }

    .icon-quiz {
      animation: icon-circle 4s linear infinite;
    }

    .icon-report {
      position: relative;
      overflow: hidden;
    }

    .icon-report::after {
      content: '';
      position: absolute;
      top: 0;
      left: -50%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
      transform: skewX(-20deg);
      animation: icon-shimmer 3s infinite;
    }

    @keyframes floaty {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-4px);
      }
    }

    @keyframes icon-circle {
      0% {
        transform: rotate(0deg) translateX(2px) rotate(0deg);
      }

      100% {
        transform: rotate(360deg) translateX(2px) rotate(-360deg);
      }
    }

    @keyframes icon-shimmer {
      0% {
        left: -100%;
      }

      20% {
        left: 200%;
      }

      100% {
        left: 200%;
      }
    }

    .flowCard h3 {
      margin: 0;
      font-size: 17px;
      font-weight: 700;
      letter-spacing: .3px;
    }

    .flowCard p {
      margin: 6px 0 0;
      color: var(--muted);
      font-weight: 700;
      font-size: 13px;
      line-height: 1.35;
    }

    .flowCard:hover {
      transform: translateY(-2px);
      transition: transform var(--t) var(--ease);
    }

    /* ---------- Forms ---------- */
    .grid2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    @media (max-width: 720px) {
      .grid2 {
        grid-template-columns: 1fr;
      }
    }

    label {
      display: block;
      font-weight: 850;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .5px;
      text-transform: uppercase;
      margin: 0 0 8px 2px;
    }

    .field {
      margin-bottom: 12px;
    }

    .error {
      color: var(--bad);
      font-weight: 800;
      font-size: 12px;
      margin-top: 8px;
      display: none;
    }

    .error.show {
      display: block;
      animation: pop 420ms var(--ease) both;
    }

    @keyframes pop {
      0% {
        opacity: 0;
        transform: translateY(6px);
        filter: blur(4px);
      }

      100% {
        opacity: 1;
        transform: translateY(0);
        filter: blur(0);
      }
    }

    /* ---------- Upload ---------- */
    .upload-zone {
      padding: 16px;
      border-radius: 26px;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      /* Mantém base anterior e adiciona melhorias */
      border: 2px dashed rgba(91, 124, 255, 0.3);
      /* Borda mais visível por padrão */
      background: rgba(255, 255, 255, 0.4);
      /* Leve fundo para diferenciar */
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .upload-zone .inner {
      padding: 18px;
      border-radius: var(--radius);
      min-height: 180px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      position: relative;
    }

    .upload-zone:hover,
    .upload-zone.dragover {
      border-color: var(--brand);
      background: rgba(255, 255, 255, 0.6);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(91, 124, 255, 0.15);
    }

    /* Estado de Sucesso (Novo) */
    .upload-zone.valid {
      border-style: solid;
      border-color: var(--ok);
      background: rgba(46, 203, 139, 0.05);
    }

    .upload-zone .hint {
      flex: 1;
      min-width: 220px;
    }

    .upload-zone h3 {
      margin: 0 0 6px;
      font-size: 16px;
      letter-spacing: .2px;
    }

    .upload-zone p {
      margin: 0;
      color: var(--muted);
      font-weight: 720;
      line-height: 1.45;
      font-size: 13px;
    }

    .upload-zone .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .4px;
      color: rgba(255, 255, 255, .95);
      background: linear-gradient(135deg, rgba(91, 124, 255, 1), rgba(255, 74, 162, 1));
      box-shadow:
        12px 12px 22px rgba(20, 30, 50, .18),
        -12px -12px 22px rgba(255, 255, 255, .65);
      white-space: nowrap;
    }

    .upload-zone input {
      display: none;
    }

    .frameGuide {
      width: 170px;
      height: 190px;
      border-radius: 40px;
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg, rgba(255, 255, 255, .35), rgba(255, 255, 255, .12));
      border: 1px dashed rgba(91, 124, 255, .45);
      box-shadow:
        inset 10px 10px 18px rgba(20, 30, 50, .10),
        inset -10px -10px 18px rgba(255, 255, 255, .60);
      display: grid;
      place-items: center;
    }

    .frameGuide::after {
      content: "";
      position: absolute;
      inset: 10px;
    }

    /* New Grid Faces CSS - "Second Image" Style */
    .grid-faces {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
    }

    .faceCard {
      position: relative;
      aspect-ratio: 1/1;
      border-radius: 24px;
      /* Squircle-ish */
      overflow: hidden;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s, box-shadow 0.2s;
      /* Background color is set inline from option swatch */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .faceCard:hover {
      transform: scale(1.03);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .faceCard.selected {
      outline: 4px solid #fff;
      box-shadow: 0 0 0 4px var(--brand);
      transform: scale(1.05);
      z-index: 10;
    }

    /* The face image is masked to an oval and centered */
    .faceCard img {
      width: 65%;
      height: 78%;
      object-fit: cover;
      object-position: center;
      border-radius: 50%;
      /* Oval shape */
      /* Optional: subtle shadow for depth */
      box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
    }

    /* Hide label for cleaner look as per image */
    .faceLabel {
      display: none;
    }



    .frameGuide .oval {
      width: 86px;
      height: 116px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, .35);
      box-shadow: 0 10px 30px rgba(91, 124, 255, .10);
    }

    .previewWrap {
      margin-top: 14px;
      display: flex;
      gap: 14px;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .previewCard {
      width: 240px;
      padding: 12px;
      border-radius: var(--radius);
    }

    .previewFrame {
      width: 100%;
      aspect-ratio: 4/5;
      border-radius: 28px;
      overflow: hidden;
      position: relative;
      background: rgba(255, 255, 255, .15);
      border: 1px solid rgba(255, 255, 255, .45);
      box-shadow:
        inset 10px 10px 18px rgba(20, 30, 50, .10),
        inset -10px -10px 18px rgba(255, 255, 255, .58);
    }

    .previewFrame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center 20%;
      display: block;
      filter: saturate(1.02) contrast(1.02);
    }

    .previewFrame::after {
      content: "";
      position: absolute;
      inset: 12px;
      border-radius: 22px;
      border: 2px solid rgba(255, 255, 255, .30);
      pointer-events: none;
    }

    .qualityList {
      flex: 1 1 260px;
      padding: 14px;
      border-radius: var(--radius);
      min-width: min(260px, 100%);
    }

    .qualityList h4 {
      margin: 0 0 8px;
      font-size: 14px;
    }

    .bullets {
      display: grid;
      gap: 8px;
      margin: 0;
      padding: 0;
      list-style: none;
      color: var(--muted);
      font-weight: 760;
      font-size: 13px;
      line-height: 1.35;
    }

    .bullets li {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      margin-top: 4px;
      background: linear-gradient(135deg, rgba(91, 124, 255, 1), rgba(255, 74, 162, 1));
      box-shadow: 0 10px 20px rgba(91, 124, 255, .15);
      flex: 0 0 auto;
    }

    /* ---------- Quiz ---------- */
    .quizCard {
      padding: 16px;
    }

    .qTop {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .qTitle {
      margin: 0;
      font-size: 18px;
      letter-spacing: .2px;
    }

    .qMeta {
      color: var(--muted);
      font-weight: 850;
      font-size: 12px;
      letter-spacing: .4px;
      text-transform: uppercase;
      text-align: right;
    }

    .qHelp {
      margin: 8px 0 0;
      color: var(--muted);
      font-weight: 720;
      font-size: 13px;
      line-height: 1.4;
      max-width: 70ch;
    }

    .optionsGrid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-top: 14px;
    }

    .optionsGrid.cols3 {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    .optionsGrid.cols4 {
      grid-template-columns: repeat(4, minmax(0, 1fr));
    }

    @media (max-width: 820px) {
      .optionsGrid.cols4 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 520px) {
      .optionsGrid {
        grid-template-columns: 1fr;
      }

      .optionsGrid.cols3 {
        grid-template-columns: 1fr;
      }

      .optionsGrid.cols4 {
        grid-template-columns: 1fr;
      }
    }

    .opt {
      border-radius: 22px;
      padding: 12px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      /* Melhoria de legibilidade e touch area */
      border: 2px solid transparent;
      /* Reserva espaço para borda sem pular layout */
      background: var(--card);
      transition: all 0.2s ease-out;
      outline: none;
      text-align: left;
      min-height: 80px;
      /* Melhora área de toque */
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .opt:hover {
      border-color: rgba(91, 124, 255, 0.3);
      transform: translateY(-2px);
    }

    @media (max-width: 768px) {

      /* Desativa efeitos de hover/tilt complexos no mobile para performance */
      .upload-zone:hover {
        transform: none;
      }

      .opt:hover {
        transform: none;
      }
    }

    .opt:focus-visible {
      box-shadow: var(--focus), 10px 10px 18px rgba(20, 30, 50, .12), -10px -10px 18px rgba(255, 255, 255, .75);
    }

    /* Estado Selecionado "Premium" */
    .opt.selected {
      background: #fff;
      border-color: var(--brand);
      box-shadow:
        0 0 0 4px rgba(91, 124, 255, 0.15),
        /* Anel de foco externo */
        0 10px 20px rgba(91, 124, 255, 0.2);
      transform: scale(1.02);
      z-index: 10;
      /* Garante que fique acima */
    }

    /* Ajuste de Texto na Seleção (Contraste) */
    .opt.selected .txt strong {
      color: var(--brand);
    }

    .opt.selected .txt span {
      color: var(--text);
      /* Removemos o branco para manter legibilidade em fundo claro */
      font-weight: 600;
    }

    .swatch {
      width: 64px;
      height: 64px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(255, 255, 255, .55), rgba(255, 255, 255, .18));
      border: 1px solid rgba(255, 255, 255, .5);
      box-shadow:
        inset 8px 8px 14px rgba(20, 30, 50, .10),
        inset -8px -8px 14px rgba(255, 255, 255, .58);
      flex: 0 0 auto;
      position: relative;
      overflow: hidden;
    }

    .swatch.eye::after {
      content: "";
      position: absolute;
      inset: 8px;
      border-radius: 999px;
      background: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, .7), rgba(0, 0, 0, .0) 40%),
        radial-gradient(circle at 60% 70%, rgba(0, 0, 0, .25), rgba(0, 0, 0, 0) 55%);
      mix-blend-mode: overlay;
      opacity: .85;
    }

    .opt .txt {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 0;
      flex: 1;
    }

    .opt .txt strong {
      font-size: 13px;
      letter-spacing: .15px;
      line-height: 1.1;
    }

    .opt .txt span {
      color: var(--muted);
      font-weight: 720;
      font-size: 12px;
      line-height: 1.2;
    }

    /* UX Improvement for text-only options (Q7, Q9, Q10, Q11) */
    .opt.text-centered {
      justify-content: flex-start;
      text-align: left;
      padding: 18px 14px;
      /* More padding for cleaner look */
    }

    .opt.text-centered .txt {
      align-items: flex-start;
      gap: 6px;
    }

    .opt.text-centered .txt strong {
      font-size: 14px;
      /* Slightly larger for emphasis */
    }

    .opt.selected .txt span {
      /* color managed above */
    }

    .quizNav {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 14px;
      flex-wrap: wrap;
    }

    .hintInline {
      color: var(--muted);
      font-weight: 750;
      font-size: 12px;
      margin-top: 10px;
      display: none;
    }

    .hintInline.show {
      display: block;
    }

    /* ---------- Loading / Scanner ---------- */
    .centerStack {
      padding: 18px;
      display: grid;
      place-items: center;
      text-align: center;
    }

    .spinner {
      width: 86px;
      height: 86px;
      border-radius: 999px;
      background: var(--card);
      box-shadow:
        inset 10px 10px 18px rgba(20, 30, 50, .14),
        inset -10px -10px 18px rgba(255, 255, 255, .72);
      position: relative;
      margin: 6px 0 14px;
      overflow: hidden;
      animation: breathe 2.2s var(--ease) infinite;
    }

    .spinner::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: conic-gradient(from 0deg, rgba(91, 124, 255, 1), rgba(123, 77, 255, 1), rgba(255, 74, 162, 1), rgba(91, 124, 255, 1));
      animation: spin 2.8s linear infinite;
      opacity: .85;
    }

    .spinner::after {
      content: "";
      position: absolute;
      inset: 10px;
      background: var(--card);
      border-radius: 999px;
      box-shadow:
        inset 10px 10px 18px rgba(20, 30, 50, .14),
        inset -10px -10px 18px rgba(255, 255, 255, .72);
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes breathe {

      0%,
      100% {
        transform: translateY(0) scale(1);
      }

      50% {
        transform: translateY(-2px) scale(1.02);
      }
    }

    .scanFrame {
      width: min(420px, 100%);
      aspect-ratio: 4/5;
      border-radius: 32px;
      overflow: hidden;
      position: relative;
      margin: 14px auto 0;
      background: rgba(255, 255, 255, .15);
      border: 1px solid rgba(255, 255, 255, .45);
      box-shadow:
        inset 10px 10px 18px rgba(20, 30, 50, .10),
        inset -10px -10px 18px rgba(255, 255, 255, .58);
    }

    .scanFrame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center 20%;
      display: block;
      filter: saturate(1.03) contrast(1.04);
    }

    .scanLine {
      position: absolute;
      left: 8%;
      width: 84%;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, .85), transparent);
      box-shadow: 0 18px 40px rgba(91, 124, 255, .16);
      filter: blur(.2px);
      animation: scan 2.6s var(--ease) infinite;
      mix-blend-mode: screen;
    }

    @keyframes scan {
      0% {
        top: 6%;
        opacity: .35;
      }

      20% {
        opacity: .9;
      }

      50% {
        opacity: .6;
      }

      100% {
        top: 92%;
        opacity: .25;
      }
    }

    /* ---------- Result ---------- */
    .resultHeader {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .resultHeader h3 {
      margin: 0;
      font-size: 20px;
      letter-spacing: .2px;
    }

    .resultHeader p {
      margin: 8px 0 0;
      color: var(--muted);
      font-weight: 720;
      line-height: 1.45;
      max-width: 75ch;
      font-size: 13px;
    }

    .resultWrap {
      display: grid;
      grid-template-columns: 420px 1fr;
      gap: 14px;
      margin-top: 14px;
    }

    @media (max-width: 980px) {
      .resultWrap {
        grid-template-columns: 1fr;
      }
    }

    .orbit-container {
      position: relative;
      padding: 14px;
      border-radius: var(--radius);
      overflow: visible;
      height: fit-content;
      /* Removemos a animação infinita do container para focar nos elementos internos */
      animation: none !important;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.3));
      border: 1px solid rgba(255, 255, 255, 0.8);
      box-shadow: 0 20px 50px rgba(91, 124, 255, 0.15);
    }

    @keyframes floatOrbit {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-4px);
      }
    }

    .main-photo {
      width: 100%;
      aspect-ratio: 4/5;
      border-radius: 32px;
      overflow: visible;
      position: relative;
      background: rgba(255, 255, 255, .12);
      border: 1px solid rgba(255, 255, 255, .45);
      box-shadow:
        inset 10px 10px 18px rgba(20, 30, 50, .10),
        inset -10px -10px 18px rgba(255, 255, 255, .58);
    }

    .main-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center 20%;
      display: block;
      border-radius: 32px;
      transform: scale(0.95);
      transition: transform 1.2s cubic-bezier(0.1, 0, 0, 1);
    }

    .reveal-visible .main-photo img {
      transform: scale(1);
    }

    .orbit-layer {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .color-orb {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      filter: drop-shadow(0 10px 18px rgba(0, 0, 0, .12));
      opacity: .95;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
      animation: orbFloat 4s ease-in-out infinite alternate;
    }

    @keyframes orbFloat {
      from {
        transform: translate(-50%, -50%) scale(1);
      }

      to {
        transform: translate(-50%, -55%) scale(1.1);
      }
    }

    .color-orb::after {
      content: "";
      position: absolute;
      inset: -8px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, .75), transparent 55%);
      opacity: .65;
    }

    .palettePanel {
      padding: 14px;
      border-radius: 26px;
      margin-top: 12px;
    }

    /* Face preview inside swatches (Q12 & Q13) */
    .faceSwatch {
      width: 60px;
      height: 60px;
      border-radius: 22px;
      display: grid;
      place-items: center;
      overflow: hidden;
    }

    .faceSwatch .swatchFace {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      object-fit: cover;
      object-position: 50% 35%;
      box-shadow: 0 12px 28px rgba(0, 0, 0, .18);
      filter: saturate(1.05) contrast(1.02);
    }

    .palette-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
      margin-top: 12px;
    }

    @media (max-width: 520px) {
      .palette-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .palette-grid {
      display: grid;
      /* Ajuste para telas pequenas: min 110px permite 2 colunas em iPhone SE */
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 12px;
      margin-top: 1.5rem;
    }

    .swatchCard {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: 0.5rem;
      padding: 10px;
      border-radius: 12px;
      transition: transform 0.2s;
      overflow: hidden;
      min-height: 80px;
      /* Mais compacto */
      font-family: inherit !important;
      opacity: 0;
      /* Começa invisível */
      /* Removemos a transição CSS padrão aqui para controlar via JS/Animation */
    }

    @keyframes cardPop {
      0% {
        opacity: 0;
        transform: scale(0.8) translateY(10px);
      }

      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .swatchCard.pop-in {
      animation: cardPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    .swatchCard:hover {
      transform: translateY(-2px);
    }

    .swatchDot {
      width: 36px;
      height: 36px;
      /* margin-bottom: 6px; */
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.4);
      flex-shrink: 0;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .swatchCard strong {
      font-size: 13px;
      letter-spacing: .2px;
      margin: 0;
      display: block;
      color: var(--text-main);
    }

    .swatchCard span {
      font-size: 11px;
      font-weight: 600;
      color: var(--muted);
      display: block;
      margin-top: 2px;
    }

    .reportGrid {
      display: grid;
      gap: 12px;
    }

    .reportCard {
      padding: 14px;
      border-radius: var(--radius);
      animation: staggerIn 520ms var(--ease) both;
    }

    .reportCard:nth-child(2) {
      animation-delay: .06s;
    }

    .reportCard:nth-child(3) {
      animation-delay: .12s;
    }

    .reportCard:nth-child(4) {
      animation-delay: .18s;
    }

    .reportCard:nth-child(5) {
      animation-delay: .24s;
    }

    .reportCard:nth-child(6) {
      animation-delay: .30s;
    }

    @keyframes staggerIn {
      0% {
        opacity: 0;
        transform: translateY(10px);
        filter: blur(10px);
      }

      100% {
        opacity: 1;
        transform: translateY(0);
        filter: blur(0);
      }
    }

    .reportCard h4 {
      margin: 0 0 8px;
      font-size: 14px;
      letter-spacing: .2px;
    }

    .reportCard p,
    .reportCard li {
      color: var(--muted);
      font-weight: 720;
      font-size: 13px;
      line-height: 1.45;
      margin: 0;
    }

    .reportCard ul {
      margin: 8px 0 0;
      padding-left: 18px;
    }

    .pillRow {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .pill {
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 11px;
      letter-spacing: .5px;
      color: var(--muted);
      background: rgba(255, 255, 255, .15);
      border: 1px solid rgba(255, 255, 255, .45);
      box-shadow:
        10px 10px 18px rgba(20, 30, 50, .10),
        -10px -10px 18px rgba(255, 255, 255, .72);
    }

    /* ---------- Floating Accessibility ---------- */
    .fab {
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 50;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-end;
    }

    .fabPanel {
      width: min(320px, calc(100vw - 32px));
      padding: 12px;
      border-radius: 22px;
      display: none;
      transform: translateY(8px);
      opacity: 0;
      filter: blur(10px);
      transition: opacity var(--t) var(--ease), transform var(--t) var(--ease), filter var(--t) var(--ease);
    }

    .fabPanel.open {
      display: block;
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
    }

    .fabTop {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .fabTop strong {
      font-size: 12px;
      letter-spacing: .5px;
      text-transform: uppercase;
      color: var(--muted);
    }

    .fabRow {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* --- 1. Scanner HUD (Biometria Visual) --- */
    .scanFrame {
      /* Mantém a base */
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 30px rgba(91, 124, 255, 0.1);
    }

    /* Cantoneiras Tecnológicas */
    .scanFrame::before,
    .scanFrame::after {
      content: "";
      position: absolute;
      width: 40px;
      height: 40px;
      border: 3px solid var(--brand);
      transition: all 0.5s ease;
      opacity: 0.8;
      z-index: 5;
    }

    .scanFrame::before {
      top: 10px;
      left: 10px;
      border-right: 0;
      border-bottom: 0;
      border-radius: 8px 0 0 0;
    }

    .scanFrame::after {
      bottom: 10px;
      right: 10px;
      border-left: 0;
      border-top: 0;
      border-radius: 0 0 8px 0;
    }

    /* Animação do Scanner (Mais suave) */
    .scanLine {
      background: linear-gradient(90deg, transparent, var(--brand), transparent);
      height: 4px;
      /* Mais fina e elegante */
      box-shadow: 0 0 15px var(--brand);
    }

    /* Efeito de respiração no anel */
    .spinner {
      animation: spin 1.5s linear infinite, breathe 3s ease-in-out infinite alternate;
      box-shadow: 0 0 20px rgba(91, 124, 255, 0.3);
    }

    @keyframes breathe {
      0% {
        box-shadow: 0 0 15px rgba(91, 124, 255, 0.2);
      }

      100% {
        box-shadow: 0 0 35px rgba(91, 124, 255, 0.6);
      }
    }

    /* --- Animations de Resultado (Storytelling) --- */
    /* Esconde inicialmente para revelar via JS */
    .reveal-hidden {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s cubic-bezier(0.2, 0.8, 0.2, 1),
        transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    /* Estado visível */
    .reveal-visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Tipografia de Resultado */
    #resultTitle {
      font-size: 28px;
      background: linear-gradient(135deg, #1d2430 0%, #5a687c 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 4px;
    }

    /* --- Checkout Mobile Sticky Fix --- */
    /* Garante que o botão flutuante não cubra conteúdo importante */
    #view-checkout {
      padding-bottom: 100px;
      /* Espaço extra no final */
    }

    /* --- Fonte Global (Safety Check) --- */
    /* Força a fonte no checkout injetado caso o Tailwind não pegue */
    #view-checkout * {
      font-family: "Plus Jakarta Sans", sans-serif !important;
    }

    /* --- Layout de Faces (Sfumato + Stack) --- */
    /* NOVA REGRA: Quando tiver 3 opções, empilha uma abaixo da outra */
    /* --- FOTO OVAL + ESFUMADO ENTRE FOTO E COR --- */

    .faceCard {
      position: relative;
      aspect-ratio: 1/1;
      border-radius: 28px;
      overflow: hidden;
      cursor: pointer;
      background: #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 4px solid transparent;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .faceCard:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12);
    }

    .faceCard.selected {
      border-color: #fff;
      box-shadow:
        0 0 0 4px var(--brand),
        0 15px 35px rgba(91, 124, 255, 0.25);
      transform: scale(1.02);
      z-index: 10;
    }

    /* --- FOTO OVAL + ESFUMADO ENTRE FOTO E COR --- */
    .faceCard img {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      /* Centraliza perfeitamente */

      /* ✅ FORMATO OVAL (Referência Imagem 2) */
      /* Largura menor que altura para criar elipse vertical */
      width: 74%;
      height: 92%;

      border-radius: 50%;
      /* Em elemento retangular (74% x 92%) vira oval */

      object-fit: cover;
      object-position: center 30%;
      /* Foco no rosto */

      /* ✅ ESFUMADO (Referência Imagem 3) */
      /* Gradiente mais suave para fundir a borda */
      -webkit-mask-image: radial-gradient(ellipse at center,
          black 45%,
          rgba(0, 0, 0, 0.5) 70%,
          transparent 90%);
      mask-image: radial-gradient(ellipse at center,
          black 45%,
          rgba(0, 0, 0, 0.5) 70%,
          transparent 90%);

      transition: transform 0.5s ease;
      will-change: transform;
    }

    /* Otimização do overlay de fusão */
    .faceCard::after {
      content: "";
      position: absolute;
      /* Ajusta o overlay para bater com o tamanho da img oval */
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 76%;
      height: 94%;
      border-radius: 50%;

      pointer-events: none;

      /* Brilho suave nas bordas para integrar com o fundo (Sfumato blend) */
      box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.15);
      opacity: 0.6;
    }

    /* Hover suave: aumenta levemente a imagem DENTRO da máscara oval */
    .faceCard:hover img {
      transform: translate(-50%, -50%) scale(1.03);
    }

    /* Layout Responsivo */
    .grid-faces.stack-3 {
      grid-template-columns: 1fr;
      max-width: 320px;
      margin: 0 auto;
      gap: 24px;
    }

    /* Esconder botões de reiniciar visualmente */
    #btnRestartTop,
    #btnRestart {
      display: none !important;
    }



    .chip.active {
      background: linear-gradient(135deg, rgba(91, 124, 255, .92), rgba(123, 77, 255, .92), rgba(255, 74, 162, .92));
      color: #fff;
    }

    /* ---------- Utility ---------- */
    .sectionPad {
      padding: 18px;
    }

    .row {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .muted {
      color: var(--muted);
      font-weight: 720;
    }

    .small {
      font-size: 12px;
    }

    .divider {
      height: 1px;
      background: rgba(255, 255, 255, .5);
      box-shadow: 0 1px 0 rgba(20, 30, 50, .06);
      margin: 14px 0;
      border-radius: 999px;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }

    @media (max-width: 520px) {
      .faceSwatch {
        width: 64px;
        height: 64px;
        border-radius: 24px;
      }

      .faceSwatch .swatchFace {
        width: 48px;
        height: 48px;
      }

      .palettePanel {
        padding: 12px;
      }
    }


    .iconSwatch {
      display: grid;
      place-items: center;
    }

    .iconSwatch svg {
      display: block;
    }

    .faceSwatch {
      position: relative;
    }

    .swatchFace {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center 20%;
      filter: saturate(1.05) contrast(1.02);
    }

    .faceTint {
      position: absolute;
      inset: 0;
      border-radius: inherit;
      opacity: .55;
      pointer-events: none;
      mix-blend-mode: multiply;
    }

    .ovalEditor {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
      touch-action: none;
    }

    .ovalEditor img {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(calc(-50% + var(--tx, 0px)), calc(-50% + var(--ty, 0px))) scale(var(--s, 1));
      transform-origin: center;
      will-change: transform;
      user-select: none;
      -webkit-user-drag: none;
    }

    .ovalEditor::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(20, 30, 50, .28);
      -webkit-mask: radial-gradient(ellipse var(--ovalW, 78%) var(--ovalH, 92%) at 50% 50%, transparent 98%, #000 100%);
      mask: radial-gradient(ellipse var(--ovalW, 78%) var(--ovalH, 92%) at 50% 50%, transparent 98%, #000 100%);
      pointer-events: none;
    }

    .ovalEditor::after {
      content: "";
      position: absolute;
      left: 50%;
      top: 50%;
      width: var(--ovalW, 78%);
      height: var(--ovalH, 92%);
      transform: translate(-50%, -50%);
      border: 2px solid rgba(255, 255, 255, .65);
      border-radius: 9999px;
      pointer-events: none;
    }

    .editorControls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 10px;
    }

    .editorControls input[type="range"] {
      width: 100%;
    }

    /* --- USP Card (Olive Skin) --- */
    .card-oliva-premium {
      position: relative;
      background: #FFFFFF;
      border-radius: 28px;
      padding: 32px;
      overflow: hidden;
      transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1), box-shadow 0.4s;
      border: 1px solid rgba(255, 255, 255, 0.8);
      /* Fallback */
    }

    .card-oliva-premium::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(transparent,
          var(--primary-purple),
          var(--primary-pink),
          transparent 30%);
      animation: rotate-border 4s linear infinite;
      z-index: 0;
      opacity: 0.6;
      /* Slight transparency so it's not too harsh */
    }

    .card-oliva-premium::after {
      content: '';
      position: absolute;
      inset: 3px;
      /* Border thickness */
      background: white;
      border-radius: 26px;
      z-index: 1;
    }

    .card-oliva-premium .card-content {
      position: relative;
      z-index: 2;
    }

    .card-oliva-premium:hover {
      transform: translateY(-8px);
      box-shadow: 0 30px 60px rgba(138, 43, 226, 0.15);
    }

    .card-oliva-premium:hover .icon {
      transform: rotate(15deg) scale(1.1);
    }

    @keyframes rotate-border {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    .metallic-text {
      background: linear-gradient(90deg, #333 0%, #888 20%, #333 40%, #333 100%);
      background-size: 200% auto;
      color: #333;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shineMetal 4s linear infinite;
    }

    @keyframes shineMetal {
      to {
        background-position: 200% center;
      }
    }

    /* --- COLORFY PREMIUM UI (Adicionar ao final do CSS) --- */
    .premium-container {
      font-family: 'Plus Jakarta Sans', sans-serif;
    }

    .section-card {
      background: white;
      border-radius: 1.5rem;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      border: 1px solid #f1f5f9;
    }

    .color-dot {
      width: 3.5rem;
      height: 3.5rem;
      border-radius: 50%;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: 3px solid white;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .color-dot:hover {
      transform: scale(1.15);
      z-index: 10;
    }

    .animate-up {
      animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
      opacity: 0;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .delay-100 {
      animation-delay: 100ms;
    }

    .delay-200 {
      animation-delay: 200ms;
    }

    .delay-300 {
      animation-delay: 300ms;
    }

    .delay-400 {
      animation-delay: 400ms;
    }

    .delay-500 {
      animation-delay: 500ms;
    }

    /* === UX Mobile Polish (safe, no logic impact) === */
    :root {
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    body {
      padding-top: var(--safe-top);
      padding-bottom: var(--safe-bottom);
    }

    @media (max-width: 420px) {
      .container {
        padding-left: 14px !important;
        padding-right: 14px !important;
      }

      .card {
        border-radius: 18px !important;
      }
    }

    /* --- Q10 Poster Layout (Full Image Fix) --- */
    .optionsGrid.poster {
      gap: 16px;
    }

    .optionsGrid.poster .opt {
      flex-direction: column;
      text-align: center;
      align-items: center;
      justify-content: flex-start;
      padding: 14px;
      height: auto;
      gap: 14px;
    }

    .optionsGrid.poster .swatch {
      width: 100%;
      height: auto;
      aspect-ratio: 1080/229;
      /* Specific ratio provided by user */
      border-radius: 12px;
      background-size: cover !important;
      /* Ensure full fill */
      background-repeat: no-repeat !important;
      background-position: center !important;
      margin: 0;
      background-color: transparent;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .optionsGrid.poster .txt {
      width: 100%;
    }

    /* --- Q9 Wide Layout (landscape images 512x211) --- */
    .optionsGrid.wide {
      gap: 14px;
    }

    .optionsGrid.wide .opt {
      flex-direction: column;
      text-align: left;
      align-items: flex-start;
      justify-content: flex-start;
      padding: 12px;
      height: auto;
      gap: 10px;
    }

    .optionsGrid.wide .swatch {
      width: 100%;
      height: auto;
      aspect-ratio: 512 / 211;
      border-radius: 10px;
      background-size: cover !important;
      background-repeat: no-repeat !important;
      background-position: center !important;
      margin: 0;
      background-color: transparent;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .optionsGrid.wide .txt {
      width: 100%;
    }

    @keyframes brandScroll {
      from {
        transform: translateX(0);
      }

      to {
        transform: translateX(-50%);
      }
    }

    /* --- MOBILE UPLOAD FIX (ETAPA 3) --- */
    @media (max-width: 640px) {
      .upload-zone .inner {
        flex-direction: column;
        /* Hint top, Frame bottom */
        align-items: center;
        text-align: center;
        gap: 24px;
        padding: 24px 16px;
        /* Ensure padding doesn't eat too much width */
      }

      .upload-zone .hint {
        min-width: 0;
        width: 100%;
        text-align: center;
      }

      .upload-zone .badge {
        margin: 0 auto;
        /* Center badge */
      }

      /* Adjust section padding for mobile to prevent cut-off */
      .app {
        padding-left: 16px;
        padding-right: 16px;
        overflow-x: hidden;
        /* Prevent horizontal scroll */
      }

      /* Ensure text doesn't touch edges */
      .heroTitle h2 {
        font-size: 32px;
        /* Smaller title on mobile */
      }

      .mask-reveal {
        max-width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="parallax-wrapper">
    <div class="layer-0"></div>
    <div class="layer-1">
      <div class="orb" style="top: 15%; left: 15%; width: 300px; height: 300px; background: var(--primary-purple);">
      </div>
      <div class="orb" style="top: 60%; left: 75%; width: 400px; height: 400px; background: var(--primary-pink);"></div>
    </div>
  </div>
  <main class="app" id="app">
    <header class="topbar">
      <div class="brand" id="topbarBrand">
        <img src="assets/logo-corrigida.png" alt="Colorfy" class="logo-img">
      </div>

      <div class="row">
        <!-- Button Removed -->

      </div>
    </header>

    <div class="progressWrap">
      <div class="progressBar neu-inset" aria-label="Progresso">
        <div class="progressFill" id="progressFill"></div>
      </div>
      <div class="stepLabel" id="stepLabel">Etapa 0 de 6</div>
    </div>

    <div class="shell">
      <!-- LANDING -->
      <section class="view-section active" id="view-landing">
        <div class="neu-card glass hero">
          <div class="heroTop">
            <div class="heroTitle">
              <img src="assets/logo.png" alt="Colorfy"
                style="max-height: 52px; width: auto; display: block; margin-bottom: 4px;">
              <p class="mask-reveal" style="margin-top: 24px;">
                <span style="font-variation-settings: 'wght' 700;">Sua colometria pessoal guiada por IA</span>
                <span style="font-variation-settings: 'wght' 300; opacity: 0.9;">Uma consultoria premium que gere
                  dossiês ultra personalizados com paletas espercificas para pele de subtom oliva ou paletas clássicas.
                </span>
              </p>
              <div class="ctaRow">
                <button class="neu-btn primary pulse-btn magnet-btn" id="btnStart" type="button"
                  style="padding: 18px 42px; font-size: 16px; box-shadow: var(--premium-shadow); flex: 1;">INICIAR
                  ANÁLISE</button>
              </div>

              <!-- Brand Marquee -->
              <div style="margin-top: 28px; overflow: hidden;">
                <p
                  style="text-align:center; font-size: 11px; font-weight: 600; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); opacity: 0.65; margin-bottom: 12px;">
                  Curadoria de maquiagens</p>
                <div
                  style="position: relative; overflow: hidden; mask-image: linear-gradient(to right, transparent 0%, black 12%, black 88%, transparent 100%); -webkit-mask-image: linear-gradient(to right, transparent 0%, black 12%, black 88%, transparent 100%);">
                  <div
                    style="display: flex; gap: 36px; width: max-content; animation: brandScroll 18s linear infinite;">
                    <img src="assets/chanel.png" alt="Chanel"
                      style="height: 28px; width: auto; object-fit: contain; opacity: 0.65; filter: grayscale(1);">
                    <img src="assets/dior.png" alt="Dior"
                      style="height: 28px; width: auto; object-fit: contain; opacity: 0.65; filter: grayscale(1);">
                    <img src="assets/givenchy.png" alt="Givenchy"
                      style="height: 28px; width: auto; object-fit: contain; opacity: 0.65; filter: grayscale(1);">
                    <img src="assets/guerlain.png" alt="Guerlain"
                      style="height: 28px; width: auto; object-fit: contain; opacity: 0.65; filter: grayscale(1);">
                    <img src="assets/lancome.png" alt="Lancôme"
                      style="height: 28px; width: auto; object-fit: contain; opacity: 0.65; filter: grayscale(1);">
                    <!-- duplicate for seamless loop -->
                    <img src="assets/chanel.png" alt="Chanel"
                      style="height: 28px; width: auto; object-fit: contain; opacity: 0.65; filter: grayscale(1);">
                    <img src="assets/dior.png" alt="Dior"
                      style="height: 28px; width: auto; object-fit: contain; opacity: 0.65; filter: grayscale(1);">
                    <img src="assets/givenchy.png" alt="Givenchy"
                      style="height: 28px; width: auto; object-fit: contain; opacity: 0.65; filter: grayscale(1);">
                    <img src="assets/guerlain.png" alt="Guerlain"
                      style="height: 28px; width: auto; object-fit: contain; opacity: 0.65; filter: grayscale(1);">
                    <img src="assets/lancome.png" alt="Lancôme"
                      style="height: 28px; width: auto; object-fit: contain; opacity: 0.65; filter: grayscale(1);">
                  </div>
                </div>
              </div>

              <p
                style="margin-top: 24px; font-size: 13px; color: var(--muted); opacity: 0.8; max-width: 400px; line-height: 1.5;">
                <strong>Dica:</strong> resultados melhores com selfie em luz natural, sem filtros, rosto centralizado e
                nítido.
              </p>
            </div>

            <aside class="neu-card glass socialProof">
              <p class="big">
                <span class="muted">Sobre a Colorfy</span>
                <strong>Resultados reais, precisão real.</strong>
                <span class="proof-desc">Mais de 120 mulheres passaram por testes presenciais de colorimetria, com
                  diagnósticos que bateram exatamente com os nossos resultados.</span>
              </p>
              <div class="avatars" aria-label="Usuárias satisfeitas">
                <div class="avatar" data-tooltip="Ana"><img class="avatarImg"
                    src="data:image/jpeg;base64,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"
                    alt="Usuária 1" /></div>
                <div class="avatar" data-tooltip="Beatriz"><img class="avatarImg"
                    src="data:image/jpeg;base64,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"
                    alt="Usuária 2" /></div>
                <div class="avatar" data-tooltip="Carla"><img class="avatarImg"
                    src="data:image/jpeg;base64,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"
                    alt="Usuária 3" /></div>
                <div class="avatar" data-tooltip="Diana"><img class="avatarImg"
                    src="data:image/jpeg;base64,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"
                    alt="Usuária 4" /></div>
                <div class="avatar" data-tooltip="Elena"><img class="avatarImg"
                    src="data:image/jpeg;base64,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"
                    alt="Usuária 5" /></div>
              </div>
              <div class="stars" aria-label="Avaliação 5 estrelas">
                <div class="star" aria-hidden="true"></div>
                <div class="star" aria-hidden="true"></div>
                <div class="star" aria-hidden="true"></div>
                <div class="star" aria-hidden="true"></div>
                <div class="star" aria-hidden="true"></div>
              </div>
              <p class="quote">
                <strong style="display:block; margin-bottom:4px; color:var(--text); font-size:14px;">Ana Beatriz - Belo
                  Horizonte</strong>
                “Relatório muito mais completo do que eu imaginava. Eu finalmente entendi por que algumas cores me
                apagavam.”
              </p>
            </aside>
          </div>

          <!-- Feature Highlight: Olive Skin -->
          <!-- Feature Highlight: Olive Skin -->
          <div class="card-oliva-premium animate-up delay-200" style="margin-top: 32px;">
            <div class="card-content" style="display: flex; align-items: flex-start; gap: 16px;">
              <div
                style="flex-shrink: 0; width: 40px; height: 40px; border-radius: 12px; background: rgba(123, 77, 255, 0.1); display: flex; align-items: center; justify-content: center; color: #6366f1;">
                <i class="fa-solid fa-wand-magic-sparkles" style="font-size: 18px;"></i>
              </div>
              <div>
                <p style="font-size: 15px; font-weight: 500; color: #475569; margin: 0; line-height: 1.6;">
                  <span style="color: #6366f1; font-weight: 700;">Colorfy</span> é o único software de
                  colorimetria
                  que parte do pressuposto de que a <strong class="metallic-text" style="font-weight: 900;">pele oliva
                    existe</strong> — e precisa ser identificada antes de lhe classificar em uma paleta.
                </p>
              </div>
            </div>
          </div>

          <div class="divider" aria-hidden="true"></div>

          <div class="flowGrid" id="howBlock" style="scroll-margin-top: 120px;">
            <div class="neu-card glass flowCard" style="transition-delay: 0ms;">
              <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 8px;">
                <div class="icon icon-upload" aria-hidden="true" style="margin-bottom: 0;">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                    <path d="M12 3v10" stroke="rgba(91,124,255,1)" stroke-width="2" stroke-linecap="round" />
                    <path d="M8 7l4-4 4 4" stroke="rgba(255,74,162,1)" stroke-width="2" stroke-linecap="round"
                      stroke-linejoin="round" />
                    <path d="M5 14v5a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-5" stroke="rgba(123,77,255,1)" stroke-width="2"
                      stroke-linecap="round" />
                  </svg>
                </div>
                <h3>Upload</h3>
              </div>
              <p>Envie uma selfie em luz natural, nítida e sem cortes. A IA valida a qualidade antes de analisar.</p>
            </div>

            <div class="neu-card glass flowCard" style="transition-delay: 150ms;">
              <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 8px;">
                <div class="icon icon-quiz" aria-hidden="true" style="margin-bottom: 0;">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                    <path d="M10.5 4.5a6 6 0 1 0 0 12a6 6 0 0 0 0-12Z" stroke="rgba(91,124,255,1)" stroke-width="2" />
                    <path d="M15.5 15.5L20 20" stroke="rgba(255,74,162,1)" stroke-width="2" stroke-linecap="round" />
                    <path d="M8.3 9.7c.6-1.2 1.9-2 3.4-2" stroke="rgba(123,77,255,1)" stroke-width="2"
                      stroke-linecap="round" />
                  </svg>
                </div>
                <h3>Quiz</h3>
              </div>
              <p>Perguntas técnicas com imagens realistas (olhos, esclera, cabelo, veias, molduras). Sem poluição
                visual.</p>
            </div>

            <div class="neu-card glass flowCard" style="transition-delay: 300ms;">
              <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 8px;">
                <div class="icon icon-report" aria-hidden="true" style="margin-bottom: 0;">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                    <path d="M7 3h7l3 3v15a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z" stroke="rgba(91,124,255,1)"
                      stroke-width="2" />
                    <path d="M14 3v4h4" stroke="rgba(255,74,162,1)" stroke-width="2" />
                    <path d="M8 12h8M8 16h6" stroke="rgba(123,77,255,1)" stroke-width="2" stroke-linecap="round" />
                  </svg>
                </div>
                <h3>Relatório</h3>
              </div>
              <p>Paleta final, combinações, “use com moderação”, gestão de contraste e aplicação prática no mundo real.
              </p>
            </div>
          </div>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <div class="row">
          <!-- Footer Removed -->
        </div>
    </div>
    </section>

    <!-- REGISTER -->
    <section class="view-section" id="view-register">
      <div class="neu-card glass sectionPad">
        <div style="text-align: center; margin-bottom: 28px;">
          <h3 style="margin:0; font-size: 28px; font-weight: 800; letter-spacing: -0.5px; color: var(--text-main);">
            Vamos começar</h3>
          <p class="muted" style="margin: 8px auto 0; max-width: 48ch; font-size: 15px; line-height: 1.5;">
            É rapidinho. Seu dossiê completo em menos de 10 minutos.
          </p>
        </div>

        <div class="divider"></div>

        <div class="grid2">
          <div class="field">
            <label for="name">Nome</label>
            <input class="neu-input" id="name" type="text" placeholder="Seu nome" autocomplete="name" />
            <div class="error" id="errName">Ops, precisamos do seu nome para personalizar a análise.</div>
          </div>

          <div class="field">
            <label for="email">Email</label>
            <input class="neu-input" id="email" type="email" placeholder="voce@exemplo.com" autocomplete="email" />
            <div class="error" id="errEmail">Inclua um email válido para salvar e recuperar seu relatório.</div>
          </div>

          <div class="field">
            <label for="phone">Telefone</label>
            <input class="neu-input" id="phone" type="tel" placeholder="(00) 00000-0000" autocomplete="tel" />
          </div>

          <div class="field">
            <label for="goal">Objetivo principal</label>
            <select class="neu-input" id="goal" aria-label="Objetivo principal">
              <option value="">Selecione…</option>
              <option>Roupas do dia a dia</option>
              <option>Maquiagem</option>
              <option>Posicionamento</option>
              <option>Presença digital (fotos/redes)</option>
              <option>Consultoria / trabalho</option>
            </select>
            <div class="error" id="errGoal">Escolha um objetivo — ajuda a deixar as recomendações mais úteis.</div>
          </div>
        </div>

        <div class="row" style="justify-content:space-between; margin-top: 14px;">
          <button class="neu-btn" type="button" data-nav="back">Voltar</button>
          <button class="neu-btn primary" id="btnToVideo" type="button">Continuar</button>
        </div>
      </div>
    </section>

    <!-- VIDEO -->
    <section class="view-section" id="view-video">
      <div class="neu-card glass sectionPad centerStack">
        <h3 style="margin:0 0 24px; font-size:28px; font-weight:800; letter-spacing:-0.5px; color:var(--text-main);">
          Orientações</h3>

        <div id="intro-video-step" class="video-step">
          <!-- Vturb Smart Player -->
          <div
            style="height: min(70vh, 560px); width: calc(min(70vh, 560px) * 9 / 16); margin: 0 auto; position: relative; overflow: hidden; border-radius: 16px;">
            <vturb-smartplayer id="vid-699505cebb2e3acf42b511e4"
              style="display: block; width: 100%; height: 100%; position: absolute; top: 0; left: 0;"></vturb-smartplayer>
          </div>
          <!-- Vturb player script is lazy-loaded when this view becomes active -->
          <div id="vturbPlayerLoader"
            data-player-src="https://scripts.converteai.net/f19c8753-f7c1-411f-b413-7315d568c5f7/players/699505cebb2e3acf42b511e4/v4/player.js">
          </div>


          <button id="startAfterVideoBtn" class="neu-btn primary" style="display:none; margin-top: 20px; width: 100%;">
            Continuar
          </button>
        </div>

      </div>
    </section>

    <!-- UPLOAD -->
    <section class="view-section" id="view-upload">
      <div class="neu-card glass sectionPad">
        <div class="row" style="justify-content:space-between;">
          <div>
            <h3 style="margin:0; font-size:20px;">Envie sua selfie para análise</h3>
            <p class="muted" style="margin:8px 0 0; max-width:85ch;">
              Carregue uma foto de rosto sob luz natural, sem maquiagem e sem filtros para precisão máxima.
              Retire <strong>brincos, piercings, óculos</strong>. Prenda o <strong>seu cabelo para trás,
                para não aparecer na imagem. </strong>.
              Use uma imagem <strong>nítida e de boa qualidade</strong>, com o rosto centralizado e <strong>sem
                cortes</strong>.
            </p>
          </div>

        </div>

        <div class="divider"></div>

        <div class="upload-zone neu-card glass" id="uploadZone" role="button" tabindex="0" aria-label="Área de upload">
          <div class="inner neu-inset" id="uploadInner" style="justify-content: center;">
            <div class="hint">
              <h3>Arraste e solte sua foto aqui</h3>
              <p>
                Ou clique para selecionar. A moldura ajuda a enquadrar o rosto sem cortes — pense em “foto de
                documento”, mas natural.
              </p>
              <div style="margin-top: 10px">
                <span class="badge">
                  <span aria-hidden="true">⬆</span> Upload seguro
                </span>
              </div>
            </div>

            <input id="fileInput" type="file" accept="image/*" />
          </div>
        </div>

        <div class="previewWrap">
          <div class="neu-card glass previewCard" id="previewCard" style="display:none;">
            <div class="previewFrame" aria-label="Prévia da selfie">
              <div class="ovalEditor" id="ovalEditor" style="--ovalW:78%;--ovalH:92%;">
                <img id="previewImg" alt="Prévia da selfie enviada" />
              </div>
            </div>
            <div class="editorControls" id="editorControls" style="display:none;">
              <label class="muted small" style="min-width:44px;">Zoom</label>
              <input id="zoomRange" type="range" min="1" max="1.8" step="0.01" value="1" />
            </div>
            <p class="muted small" style="margin:10px 2px 0;">
              Enquadramento automático sem cortes (ajuste: rosto centralizado).
            </p>
          </div>

          <div class="neu-card glass qualityList">
            <h4>Checklist rápido (para precisão máxima)</h4>
            <ul class="bullets">
              <li><span class="dot"></span><span>Rosto inteiro visível (testa e queixo sem cortar).</span></li>
              <li><span class="dot"></span><span>Luz natural frontal suave (evite luz “estourada”).</span></li>
              <li><span class="dot"></span><span>Sem maquiagem pesada, sem filtro, sem modo “beauty”.</span></li>
              <li><span class="dot"></span><span>Retire óculos, brincos grandes e piercings chamativos.</span></li>
              <li><span class="dot"></span><span>Cabelo fora do rosto, sobrancelhas visíveis.</span></li>
            </ul>
            <div class="error" id="errPhoto" style="display:block; margin-top:12px;">
              Envie uma imagem para continuarmos.
            </div>
          </div>
        </div>

        <div class="row" style="justify-content:space-between; margin-top: 14px;">
          <button class="neu-btn" type="button" data-nav="back">Voltar</button>
          <button class="neu-btn primary" id="btnToQuiz" type="button" disabled
            style="opacity:.6; cursor:not-allowed;">Continuar</button>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <section class="view-section" id="view-quiz">
      <div class="neu-card glass quizCard">
        <div class="qTop">
          <div>
            <h3 class="qTitle" id="qTitle">Pergunta</h3>
            <p class="qHelp" id="qHelp">
              Observe com calma. Suas respostas refinam a classificação e ajudam a resolver empates com critérios
              técnicos.
            </p>
          </div>
          <div class="qMeta" id="qMeta">Pergunta 1</div>
        </div>

        <div id="qOptions" class="optionsGrid"></div>

        <div class="hintInline" id="qHint">Escolha uma opção para avançarmos.</div>

        <div class="quizNav">
          <button class="neu-btn" id="btnPrevQ" type="button">Voltar</button>
          <button class="neu-btn primary" id="btnNextQ" type="button">Próxima</button>
        </div>
      </div>
    </section>

    <!-- LOADING -->
    <section class="view-section" id="view-loading">
      <div class="neu-card glass sectionPad centerStack">
        <div class="spinner" aria-hidden="true"></div>
        <h3 style="margin:0; font-size:18px;">Processando sua análise cromática…</h3>
        <p class="muted" id="loadingMsg" style="margin:10px 0 0; max-width:70ch;">
          Cruzando suas respostas com leitura visual de contraste, valor e profundidade.
        </p>
      </div>
    </section>

    <section class="view-section" id="view-payment-pending">
      <div class="neu-card glass sectionPad centerStack">
        <h3 style="margin:0; font-size:18px;">Pagamento ainda não confirmado (processando).</h3>
        <p class="muted" id="pendingMsg" style="margin:10px 0 0; max-width:70ch;">
          Se você acabou de pagar, pode levar alguns segundos para confirmar. Clique em “Verificar novamente”.
        </p>

        <div class="row" style="margin-top:14px;">
          <button class="neu-btn primary" id="btnRetryPayment" type="button">Verificar novamente</button>
          <button class="neu-btn" id="btnBackToCheckout" type="button">Voltar ao checkout</button>
        </div>

        <p class="muted small" style="margin:12px 0 0;">
          Dica: se você pagou em outra aba, volte para esta página e tente novamente.
        </p>
      </div>
    </section>

    <!-- SCANNER -->
    <section class="view-section" id="view-scanner">
      <div class="neu-card glass sectionPad centerStack">
        <h3 style="margin:0; font-size:18px;">Leitura facial (scanner)</h3>
        <p class="muted" style="margin:10px 0 0; max-width:70ch;">
          Lendo áreas de luz e sombra, contraste entre pele/cabelo/olhos e sinais de subtom para validação fina.
        </p>
        <div class="scanFrame" id="scanFrame">
          <img id="scanImg" alt="Selfie para leitura facial" />
          <div class="scanLine" aria-hidden="true"></div>
        </div>
        <div class="row" style="justify-content:center; margin-top: 12px;">
          <span class="pill">Precisão depende da foto</span>
          <span class="pill">Sem filtros</span>
          <span class="pill">Boa luz</span>
        </div>
      </div>
    </section>

    <!-- CHECKOUT (Injected) -->
    <section class="view-section" id="view-checkout" style="text-align:left;">
      <script>
        tailwind.config = {
          theme: {
            extend: {
              fontFamily: {
                sans: ['"Plus Jakarta Sans"', 'sans-serif'],
              },
              colors: {
                brand: {
                  primary: '#6366f1',
                  secondary: '#ec4899',
                  dark: '#0f172a',
                }
              }
            }
          }
        }
      </script>
      <style>
        .gradient-text {
          background: linear-gradient(to right, #6366f1, #ec4899);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
        }

        .gradient-bg {
          background: linear-gradient(to right, #6366f1, #ec4899);
        }

        .mockup-shadow {
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Reset some styles for this section to avoid conflicts */
        #view-checkout h1,
        #view-checkout h2,
        #view-checkout h3,
        #view-checkout p {
          margin: initial;
        }


        /* ---------- Result micro-interactions (UX polish) ---------- */
        @keyframes fadeUp {
          from {
            opacity: 0;
            transform: translateY(10px);
            filter: blur(2px);
          }

          to {
            opacity: 1;
            transform: translateY(0);
            filter: blur(0);
          }
        }

        .stagger-item {
          opacity: 0;
          animation: fadeUp 520ms ease forwards;
          will-change: transform, opacity, filter;
        }

        .swatchCard {
          display: flex;
          gap: 12px;
          align-items: center;
          transition: transform 220ms ease, box-shadow 220ms ease;
        }

        .swatchCard:hover {
          transform: translateY(-3px) scale(1.01);
        }

        .swatchDot {
          width: 44px;
          height: 44px;
          border-radius: 14px;
          box-shadow: 0 10px 24px rgba(0, 0, 0, 0.14);
          transition: transform 220ms ease;
          flex: 0 0 auto;
        }

        .swatchCard:hover .swatchDot {
          transform: scale(1.06);
        }

        /* ---------- Print (Download as PDF) ---------- */
        @media print {

          /* Show only the result view */
          .view-section {
            display: none !important;
          }

          #view-result {
            display: block !important;
          }

          #auditBlock {
            display: none !important;
          }

          /* Hide interactive controls */
          button,
          .neu-btn,
          nav,
          .floating,
          .toast {
            display: none !important;
          }

          html,
          body {
            background: #fff !important;
            color: #111 !important;
          }

          /* Remove heavy effects for crisp PDF */
          .glass,
          .neu-card,
          .neu-inset {
            box-shadow: none !important;
            background: #fff !important;
            border: 1px solid #e5e7eb !important;
          }

          /* Prevent awkward breaks */
          .swatchCard,
          .resultWrap,
          .sectionPad {
            break-inside: avoid;
            page-break-inside: avoid;
          }
        }

        /* --- Video Player Styles --- */
        .video-step {
          width: 100%;
          max-width: 520px;
          margin: 0 auto;
        }

        .video-wrapper {
          position: relative;
          width: 100%;
          aspect-ratio: 9 / 16;
          border-radius: 16px;
          overflow: hidden;
          background: #000;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .video-wrapper video {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .video-overlay {
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, 0.35);
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          z-index: 10;
          transition: opacity 0.3s ease;
        }

        .play-button {
          width: 72px;
          height: 72px;
          background: rgba(255, 255, 255, 0.92);
          clip-path: polygon(32% 22%, 32% 78%, 80% 50%);
          transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .video-overlay:hover .play-button {
          transform: scale(1.1);
          background: #fff;
        }
      </style>

      <div
        class="relative w-full max-w-md mx-auto bg-white min-h-[80vh] shadow-2xl overflow-hidden rounded-3xl font-sans text-slate-800">

        <!-- Navbar -->
        <nav class="absolute top-0 w-full bg-white/90 backdrop-blur-md z-50 border-b border-gray-100">
          <div class="px-4 h-16 flex items-center justify-between">
            <div class="text-2xl font-extrabold tracking-tight">
              <span class="gradient-text">Colorfy</span>
            </div>
            <!-- CTA Button Simulating Payment -->
            <button id="btnCheckoutTop" type="button"
              class="bg-black text-white px-4 py-2 rounded-full text-xs font-bold hover:scale-105 transition-transform">
              VER RELATÓRIO
            </button>
          </div>
        </nav>

        <!-- Main Content -->
        <div class="pt-20 pb-24">
          <!-- Hero Section -->
          <section class="px-5 py-8 text-center relative overflow-hidden">
            <div
              class="inline-flex items-center gap-1 bg-indigo-50 border border-indigo-100 px-3 py-1 rounded-full mb-6">
              <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
              <span class="text-xs font-semibold text-indigo-600 uppercase tracking-wide">Análise Concluída</span>
            </div>
            <h1 class="text-3xl md:text-4xl font-extrabold leading-tight mb-4 text-slate-900">
              Relatório completo com sua <span class="gradient-text">paleta personalizada</span> pronto para acesso!
            </h1>
            <p class="text-gray-500 text-lg mb-8 leading-relaxed">
              Descubra sua melhor versão com nossa análise profissional de colorimetria guiada por IA.
            </p>

            <!-- CTA Principal -->
            <div class="space-y-3">
              <button id="btnCheckoutHero" type="button"
                class="block w-full gradient-bg text-white font-bold text-lg py-4 rounded-xl shadow-lg shadow-indigo-500/30 hover:shadow-indigo-500/50 hover:-translate-y-1 transition-all duration-300">
                QUERO ACESSO IMEDIATO
                <i class="fa-solid fa-arrow-right ml-2"></i>
              </button>
              <p class="text-xs text-gray-400 flex items-center justify-center gap-1">
                <i class="fa-solid fa-lock"></i> Compra 100% Segura e Instantânea
              </p>
            </div>
          </section>

          <!-- Features Grid -->
          <section class="px-5 py-10 bg-gray-50">
            <div class="text-center mb-8">
              <h2 class="text-2xl font-bold mb-2">Veja o que você vai receber</h2>
            </div>
            <!-- Cards -->
            <div class="bg-white border border-gray-100 p-5 rounded-2xl shadow-sm mb-4 flex items-start gap-4">
              <div
                class="w-12 h-12 rounded-xl bg-indigo-100 text-indigo-600 flex items-center justify-center text-xl shrink-0">
                <i class="fa-solid fa-eye"></i>
              </div>
              <div>
                <h3 class="font-bold text-lg text-slate-800">Análise da Colorimetria</h3>
                <p class="text-sm text-gray-500 mt-1">Descubra sua estação e as características da sua pele.</p>
              </div>
            </div>
            <div class="bg-white border border-gray-100 p-5 rounded-2xl shadow-sm mb-4 flex items-start gap-4">
              <div
                class="w-12 h-12 rounded-xl bg-pink-100 text-pink-600 flex items-center justify-center text-xl shrink-0">
                <i class="fa-solid fa-palette"></i>
              </div>
              <div>
                <h3 class="font-bold text-lg text-slate-800">Cores que te valorizam</h3>
                <p class="text-sm text-gray-500 mt-1">Saiba exatamente quais tons realçam sua beleza natural.</p>
              </div>
            </div>
          </section>

          <!-- Offer/Price Section -->
          <section class="px-5 pb-8 pt-8">
            <div class="bg-slate-900 rounded-3xl p-8 text-center text-white relative overflow-hidden">
              <div
                class="absolute top-0 right-0 w-32 h-32 bg-indigo-500 rounded-full blur-3xl opacity-20 -mr-10 -mt-10">
              </div>
              <div
                class="absolute bottom-0 left-0 w-32 h-32 bg-pink-500 rounded-full blur-3xl opacity-20 -ml-10 -mb-10">
              </div>

              <h3 class="text-xl font-medium text-gray-300 mb-2">Oferta Especial Limitada</h3>
              <div class="flex items-center justify-center gap-3 mb-6">
                <span class="text-gray-500 line-through text-lg">R$ 197,00</span>
                <span class="text-4xl font-extrabold text-white">R$ 67,00</span>
              </div>

              <button id="btnCheckoutOffer" type="button"
                class="block w-full bg-white text-slate-900 font-bold text-lg py-4 rounded-xl hover:bg-gray-100 transition-colors">
                PEGAR OFERTA AGORA
              </button>
            </div>
            <div class="text-center mt-4">
              <a href="https://buy.stripe.com/test_dRmbJ31LOcBI7jB3vy1Jm00" target="_blank"
                class="text-sm text-gray-400 underline hover:text-gray-600">Link original de pagamento (Stripe)</a>
            </div>
          </section>

        </div>

        <!-- Sticky Bottom CTA for Mobile -->
        <div
          class="absolute bottom-0 left-0 w-full bg-white border-t border-gray-200 p-4 shadow-[0_-10px_40px_rgba(0,0,0,0.1)] z-40 md:hidden">
          <button id="btnCheckoutBottom" type="button"
            class="block w-full gradient-bg text-white text-center font-bold py-3.5 rounded-xl shadow-lg animate-pulse">
            QUERO COMEÇAR AGORA
          </button>
        </div>
      </div>
    </section>

    <!-- RESULT -->
    <section class="view-section" id="view-result">
      <div class="neu-card glass sectionPad">
        <div id="resultContainer" class="premium-container"></div>


      </div>
    </section>
    </div>
  </main>

  <script>
    /* =========================================================
       COLORFY — Frontend SPA (Demo Local)
       - Neumorphism 2.0 base
       - Upload drag & drop + preview enquadrada
       - Quiz visual (lado a lado) + imagens realistas (swatches)
       - Scoring determinístico (baseado no mapeamento fornecido pelo usuário)
       - Gates Oliva e desempate (metodologia do PDF: oliva>=13, 60%, tiebreaker)
       - Resultado com orbes + paleta + relatório (demo)
       ========================================================= */

    const $ = (s, el = document) => el.querySelector(s);
    const $$ = (s, el = document) => Array.from(el.querySelectorAll(s));

    /* ---------- SPA ---------- */
    const views = ["view-landing", "view-register", "view-video", "view-upload", "view-quiz", "view-loading", "view-scanner", "view-checkout", "view-result"];
    let currentView = "view-landing";
    let viewStack = ["view-landing"];

    function goTo(id) {
      if (id === currentView) return;
      const cur = document.getElementById(currentView);
      const next = document.getElementById(id);
      if (!next) return;

      const header = document.querySelector("header.topbar");
      const progress = document.querySelector(".progressWrap");

      if (id === "view-checkout") {
        if (header) header.style.display = "none";
        if (progress) progress.style.display = "none";
      } else {
        if (header) header.style.display = "";
        if (progress) progress.style.display = "";
      }

      // Handle Logo Visibility (Hide topbar logo on Landing, show elsewhere) - Removing specific landing hide logic as requested to restore
      const topBrand = document.getElementById("topbarBrand");
      if (topBrand) {
        topBrand.style.opacity = "1";
        topBrand.style.visibility = "visible";
      }

      // Handle Header Alignment: Center on Landing, Left (Space-between) on others
      if (header) {
        if (id === "view-landing") {
          header.classList.add("centered");
        } else {
          header.classList.remove("centered");
        }
      }

      // Force cleanup of all sections to prevent overlaps
      views.forEach(v => {
        const el = document.getElementById(v);
        if (el && v !== id && v !== currentView) {
          el.classList.remove("active", "exit");
          el.style.display = "none";
        }
      });

      cur.classList.add("exit");
      setTimeout(() => {
        cur.classList.remove("active", "exit");
        cur.style.display = ""; // clear inline override if any

        next.style.display = ""; // FIX: Ensure target is visible despite previous cleanup
        next.classList.add("active");
        currentView = id;
        updateProgress();

        // Final cleanup helper
        $$(".view-section").forEach(el => {
          if (el.id !== currentView) el.classList.remove("active");
        });
        window.scrollTo(0, 0);
      }, 260);

      // stack (for "back" buttons)
      const last = viewStack[viewStack.length - 1];
      if (last !== id) viewStack.push(id);
    }

    function back() {
      if (viewStack.length <= 1) return;
      viewStack.pop();
      const prev = viewStack[viewStack.length - 1];
      goTo(prev);
    }

    /* ---------- Ripple on all neu-btn ---------- */
    function addRipple(btn, ev) {
      const rect = btn.getBoundingClientRect();
      const x = (ev.clientX || (rect.left + rect.width / 2)) - rect.left;
      const y = (ev.clientY || (rect.top + rect.height / 2)) - rect.top;
      const span = document.createElement("span");
      span.className = "ripple";
      span.style.left = x + "px";
      span.style.top = y + "px";
      btn.appendChild(span);
      setTimeout(() => span.remove(), 800);
    }
    function bindRipples() {
      $$(".neu-btn").forEach(btn => {
        btn.addEventListener("click", (ev) => addRipple(btn, ev));
      });
    }
    bindRipples();

    /* ---------- Progress ---------- */
    const progressFill = $("#progressFill");
    const stepLabel = $("#stepLabel");

    function updateProgress() {
      const idx = Math.max(0, views.indexOf(currentView));
      // 6 steps visible (register->result), landing is 0
      const map = {
        "view-landing": { p: 0, label: "Etapa 0 de 7" },
        "view-register": { p: 10, label: "Etapa 1 de 7" },
        "view-video": { p: 20, label: "Etapa 2 de 7" },
        "view-upload": { p: 30, label: "Etapa 3 de 7" },
        "view-quiz": { p: 50, label: "Etapa 4 de 7" },
        "view-loading": { p: 75, label: "Etapa 5 de 7" },
        "view-scanner": { p: 85, label: "Etapa 6 de 7" },
        "view-checkout": { p: 95, label: "Etapa 7 de 7" },
        "view-result": { p: 100, label: "Resultados" }
      };
      const m = map[currentView] || { p: Math.round((idx / (views.length - 1)) * 100), label: `Etapa ${idx} de ${views.length - 1}` };
      progressFill.style.width = m.p + "%";
      stepLabel.textContent = m.label;
    }
    updateProgress();

    /* ---------- State ---------- */
    const state = {
      user: { name: "", email: "", phone: "", goal: "" },
      selfie: { file: null, dataUrl: "", croppedDataUrl: "", approved: false, issues: [] },
      quiz: { answers: {}, cursor: 0, flow: [] },
      analysis: null,
      session_id: null
    };

    /* ---------- Buttons / Nav ---------- */

    $("#btnStart").addEventListener("click", () => goTo("view-register"));
    // $("#btnRestartTop").addEventListener("click", resetAll);
    // $("#btnRestart").addEventListener("click", resetAll);
    $("[data-nav='back']")?.addEventListener("click", back);
    $$("[data-nav='back']").forEach(b => b.addEventListener("click", back));


    /* ---------- Register validation ---------- */
    $("#btnToVideo").addEventListener("click", () => {
      const name = $("#name").value.trim();
      const email = $("#email").value.trim();
      const phone = $("#phone").value.trim();
      const goal = $("#goal").value;

      const okEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

      $("#errName").classList.toggle("show", !name);
      $("#errEmail").classList.toggle("show", !okEmail);
      $("#errGoal").classList.toggle("show", !goal);

      if (!name || !okEmail || !goal) return;

      state.user = { name, email, phone, goal };
      goTo("view-video");
    });

    /* ---------- Video Step ---------- */
    (function setupVideoStep() {
      const VIEW_ID = "view-video";
      const PLAYER_ID = "vid-699505cebb2e3acf42b511e4";
      const BTN_ID = "startAfterVideoBtn";

      let shown = false;
      let fallback = null;   // timer de fallback (silencioso)



      /* ── Mostra o botão Continuar ─────────────────────────────────── */
      function revealBtn() {
        if (shown) return;
        shown = true;
        clearTimeout(fallback);
        const btn = document.getElementById(BTN_ID);
        if (!btn) return;
        btn.style.opacity = "0";
        btn.style.display = "block";
        btn.style.transition = "opacity .5s ease";
        requestAnimationFrame(() => requestAnimationFrame(() => {
          btn.style.opacity = "1";
        }));
      }

      /* ── Oculta o botão ao entrar na tela ────────────────────────── */
      function hideBtn() {
        shown = false;
        clearTimeout(fallback);
        const btn = document.getElementById(BTN_ID);
        if (btn) { btn.style.display = "none"; btn.style.opacity = "0"; }
      }

      /* ── Timer silencioso de 3 min (fallback) ──────────────── */
      function startTimer() {
        clearTimeout(fallback);
        fallback = setTimeout(revealBtn, 3 * 60 * 1000);
      }

      /* ── postMessage do player Vturb (sem filtro de origem) ──────── */
      window.addEventListener("message", (ev) => {
        let d = ev.data;
        try { if (typeof d === "string") d = JSON.parse(d); } catch (_) { }
        if (!d || typeof d !== "object") return;
        const evName = String(d.event || d.action || d.type || "").toLowerCase();
        if (["ended", "videocompleted", "complete", "finish"].includes(evName)) revealBtn();
      });

      /* ── Eventos diretos no elemento Vturb + <video> interno ─────── */
      function bindPlayerEvents(el) {
        if (!el || el._vsp_bound) return;
        el._vsp_bound = true;
        ["ended", "smartplayer:ended", "videoended", "complete", "finish"].forEach(n =>
          el.addEventListener(n, revealBtn)
        );
        const vid = el.querySelector("video");
        if (vid) vid.addEventListener("ended", revealBtn);
      }

      /* ── Lazy-load do script Vturb ──────────────────────────────── */
      let scriptLoaded = false;
      function loadVturb() {
        const loader = document.getElementById("vturbPlayerLoader");
        if (!loader) return;
        const src = loader.getAttribute("data-player-src");
        if (!src) return;
        if (document.querySelector(`script[src="${src}"]`)) {
          scriptLoaded = true;
          bindPlayerEvents(document.getElementById(PLAYER_ID) || document.querySelector("vturb-smartplayer"));
          return;
        }
        if (scriptLoaded) return;
        scriptLoaded = true;
        const s = document.createElement("script");
        s.src = src;
        s.async = true;
        s.onload = () => setTimeout(() => {
          bindPlayerEvents(document.getElementById(PLAYER_ID) || document.querySelector("vturb-smartplayer"));
        }, 300);
        document.head.appendChild(s);
      }

      /* ── MutationObserver: ativa quando view-video recebe .active ── */
      function observe() {
        const view = document.getElementById(VIEW_ID);
        if (!view) return;
        new MutationObserver(() => {
          if (view.classList.contains("active")) {
            hideBtn();
            loadVturb();
            startTimer();
          }
        }).observe(view, { attributes: true, attributeFilter: ["class"] });
      }

      /* ── Botão Continuar → próxima etapa ────────────────────────── */
      function bindContinue() {
        const btn = document.getElementById(BTN_ID);
        if (btn) btn.onclick = () => goTo("view-upload");
      }

      /* ── Init ────────────────────────────────────────────────────── */
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", () => { bindContinue(); observe(); });
      } else {
        bindContinue();
        observe();
      }
    })();


    /* ---------- Upload (drag & drop + magnetic hover) ---------- */
    const uploadZone = $("#uploadZone");
    const uploadInner = $("#uploadInner");
    const fileInput = $("#fileInput");
    const previewCard = $("#previewCard");
    const previewImg = $("#previewImg");
    const ovalEditor = $("#ovalEditor");
    const zoomRange = $("#zoomRange");
    const editorControls = $("#editorControls");
    const errPhoto = $("#errPhoto");
    const btnToQuiz = $("#btnToQuiz");

    function setPhotoReady(ready) {
      btnToQuiz.disabled = !ready;
      btnToQuiz.style.opacity = ready ? "1" : ".6";
      btnToQuiz.style.cursor = ready ? "pointer" : "not-allowed";
    }

    async function photoQualityGate() {
      const issues = [];
      if (!state.selfie.dataUrl) issues.push("Sem imagem.");

      // Validação obrigatória: enquadramento no editor oval
      if (state.selfie.dataUrl) {
        const v = await validateSelfieOval();
        if (v.issues.length) issues.push(...v.issues);

        // Se aprovado, persiste o crop. Se não, limpa.
        if (issues.length === 0 && v.cropDataUrl) {
          state.selfie.croppedDataUrl = v.cropDataUrl;
        } else {
          state.selfie.croppedDataUrl = "";
        }
      }

      state.selfie.issues = issues;
      state.selfie.approved = issues.length === 0;

      errPhoto.textContent = issues.length ? issues[0] : "Foto validada. Excelente — podemos seguir.";
      errPhoto.classList.toggle("show", true);
      errPhoto.style.color = issues.length ? "var(--bad)" : "var(--ok)";

      // Visual Valid State
      if (state.selfie.approved) {
        uploadZone.classList.add("valid");
      } else {
        uploadZone.classList.remove("valid");
      }

      setPhotoReady(state.selfie.approved);
    }


    function clamp(v, min, max) { return Math.min(max, Math.max(min, v)); }

    function getEditorState() {
      return {
        tx: state.selfie.tx || 0,
        ty: state.selfie.ty || 0,
        s: state.selfie.scale || 1
      };
    }
    function applyEditorState() {
      const st = getEditorState();
      ovalEditor.style.setProperty("--tx", st.tx + "px");
      ovalEditor.style.setProperty("--ty", st.ty + "px");
      ovalEditor.style.setProperty("--s", st.s);
      zoomRange.value = st.s;
    }

    async function validateSelfieOval() {
      const issues = [];
      if (!ovalEditor || !previewImg || !previewImg.naturalWidth) return { issues: ["Sem imagem."], cropDataUrl: "" };

      // Render exatamente o enquadramento validado
      const cw = ovalEditor.clientWidth;
      const ch = ovalEditor.clientHeight;
      const nw = previewImg.naturalWidth;
      const nh = previewImg.naturalHeight;

      const base = Math.max(cw / nw, ch / nh);
      const st = getEditorState();
      const drawW = nw * base * st.s;
      const drawH = nh * base * st.s;
      const cx = cw / 2 + st.tx;
      const cy = ch / 2 + st.ty;
      const dx = cx - drawW / 2;
      const dy = cy - drawH / 2;

      const c = document.createElement("canvas");
      c.width = cw;
      c.height = ch;
      const ctx = c.getContext("2d");
      ctx.clearRect(0, 0, cw, ch);
      ctx.drawImage(previewImg, dx, dy, drawW, drawH);

      // Oval de referência (mesmo percentual do CSS)
      const ovalW = cw * 0.78;
      const ovalH = ch * 0.92;
      const ovalLeft = (cw - ovalW) / 2;
      const ovalTop = (ch - ovalH) / 2;
      const ovalRight = ovalLeft + ovalW;
      const ovalBottom = ovalTop + ovalH;
      const ovalCenterX = ovalLeft + ovalW / 2;

      // --- GERAR CROP (512x512) ---
      let cropDataUrl = "";
      try {
        const s = 512;
        const cc = document.createElement("canvas");
        cc.width = s; cc.height = s;
        const cctx = cc.getContext("2d");

        // SOLUÇÃO A (Fix): Snapshot quadrado centralizado no oval, sem distorção.
        // Pega o maior lado do oval para garantir que cabe tudo no quadrado 512x512.
        const cxOv = ovalLeft + ovalW / 2;
        const cyOv = ovalTop + ovalH / 2;
        const cropSize = Math.floor(Math.max(ovalW, ovalH)); // quadrado que engloba o oval

        // Centraliza o quadrado no centro do oval.
        // NOTA: Não clampamos srcX/srcY em 0 propositalmente. 
        // Em telas estreitas (mobile), o cropSize (altura) pode ser maior que a largura (c.width).
        // Se clampar srcX=0, o rosto desloca para a esquerda (desenquadra).
        // Deixar negativo faz o drawImage preencher com transparente nas bordas, mantendo o rosto centralizado.
        const srcX = Math.floor(cxOv - cropSize / 2);
        const srcY = Math.floor(cyOv - cropSize / 2);

        // Preenche o fundo com branco para evitar áreas transparentes/pretas se o crop sair das bordas
        cctx.fillStyle = "#FFFFFF";
        cctx.fillRect(0, 0, s, s);

        // Desenha de 'c' (visual atual) para 'cc' (512x512) mantendo proporção (quadrado->quadrado)
        cctx.drawImage(c, srcX, srcY, cropSize, cropSize, 0, 0, s, s);

        cropDataUrl = cc.toDataURL("image/jpeg", 0.92);
      } catch (err) {
        console.warn("Falha ao gerar crop", err);
      }

      if (!("FaceDetector" in window)) {
        console.warn("FaceDetector API unavailable, skipping validation.");
        return { issues: [], cropDataUrl };
      }

      try {
        const fd = new FaceDetector({ fastMode: true, maxDetectedFaces: 1 });
        const faces = await fd.detect(c);
        if (!faces || !faces.length) {
          issues.push("Rosto não detectado. Ajuste enquadramento e iluminação.");
          return { issues, cropDataUrl };
        }
        const f = faces[0];
        const box = f.boundingBox;

        // Landmarks (quando disponíveis)
        let eyeY = null;
        let noseX = null;
        if (f.landmarks && f.landmarks.length) {
          const eyes = f.landmarks.filter(l => (l.type || "").toLowerCase().includes("eye"));
          const nose = f.landmarks.find(l => (l.type || "").toLowerCase().includes("nose"));
          if (eyes.length) {
            const pts = eyes.flatMap(e => e.locations || []);
            if (pts.length) {
              eyeY = pts.reduce((a, p) => a + p.y, 0) / pts.length;
            }
          }
          if (nose && nose.locations && nose.locations.length) {
            noseX = nose.locations.reduce((a, p) => a + p.x, 0) / nose.locations.length;
          }
        }
        // Fallback aproximado via boundingBox
        if (eyeY == null) eyeY = box.y + box.height * 0.35;
        if (noseX == null) noseX = box.x + box.width * 0.50;
        const chinY = box.y + box.height;

        if (eyeY > (ovalTop + ovalH / 3)) issues.push("Posicione os olhos no terço superior do oval.");
        if (Math.abs(noseX - ovalCenterX) > ovalW * 0.12) issues.push("Centralize o nariz horizontalmente no oval.");
        if (chinY > ovalBottom) issues.push("Mantenha o queixo dentro do limite inferior do oval.");
      } catch (e) {
        issues.push("Não foi possível validar a foto. Ajuste e tente novamente.");
      }

      return { issues, cropDataUrl };
    }

    // Drag + zoom (limitado)
    (function bindEditor() {
      let dragging = false;
      let sx = 0, sy = 0, ox = 0, oy = 0;

      async function setScale(v) {
        state.selfie.scale = clamp(v, 1, 1.8);
        applyEditorState();
        // Revalidar
        await photoQualityGate();
      }

      zoomRange.addEventListener("input", () => setScale(parseFloat(zoomRange.value)));

      ovalEditor.addEventListener("pointerdown", (e) => {
        if (!state.selfie.dataUrl) return;
        dragging = true;
        ovalEditor.setPointerCapture(e.pointerId);
        sx = e.clientX; sy = e.clientY;
        ox = state.selfie.tx || 0;
        oy = state.selfie.ty || 0;
      });
      ovalEditor.addEventListener("pointermove", (e) => {
        if (!dragging) return;
        const dx = e.clientX - sx;
        const dy = e.clientY - sy;
        state.selfie.tx = ox + dx;
        state.selfie.ty = oy + dy;
        applyEditorState();
      });
      ovalEditor.addEventListener("pointerup", () => {
        if (!dragging) return;
        dragging = false;
        // Revalidar ao soltar
        photoQualityGate();
      });
      ovalEditor.addEventListener("pointercancel", () => { dragging = false; });
    })();
    function handleFile(file) {
      if (!file || !file.type.startsWith("image/")) return;
      state.selfie.file = file;
      const reader = new FileReader();
      reader.onload = async () => {
        state.selfie.tx = 0; state.selfie.ty = 0; state.selfie.scale = 1;
        state.selfie.croppedDataUrl = "";
        editorControls.style.display = "flex";
        applyEditorState();
        state.selfie.dataUrl = reader.result;
        previewImg.src = state.selfie.dataUrl;
        previewCard.style.display = "block";
        $("#scanImg").src = state.selfie.dataUrl;
        $("#resultImg").src = state.selfie.dataUrl;
        photoQualityGate();
      };
      reader.readAsDataURL(file);
    }

    uploadZone.addEventListener("click", () => fileInput.click());
    uploadZone.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); fileInput.click(); } });
    fileInput.addEventListener("change", (e) => handleFile(e.target.files[0]));

    uploadZone.addEventListener("dragover", (e) => { e.preventDefault(); uploadZone.classList.add("dragover"); });
    uploadZone.addEventListener("dragleave", () => uploadZone.classList.remove("dragover"));
    uploadZone.addEventListener("drop", (e) => {
      e.preventDefault();
      uploadZone.classList.remove("dragover");
      const file = e.dataTransfer.files && e.dataTransfer.files[0];
      handleFile(file);
    });

    // Magnetic hover effect (Apenas Desktop)
    const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    if (!isTouch) {
      uploadZone.addEventListener("mousemove", (e) => {
        const r = uploadZone.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width - 0.5;
        const y = (e.clientY - r.top) / r.height - 0.5;

        // Reduzi a intensidade da rotação para ser mais sutil (de 3 para 1.5)
        uploadZone.style.transform = `perspective(1000px) rotateX(${(-y * 1.5).toFixed(2)}deg) rotateY(${(x * 1.5).toFixed(2)}deg) scale(1.01)`;
        uploadInner.style.transform = `translate(${(x * 4).toFixed(1)}px, ${(y * 4).toFixed(1)}px)`;
      });

      uploadZone.addEventListener("mouseleave", () => {
        uploadZone.style.transform = "";
        uploadInner.style.transform = "";
      });
    }

    btnToQuiz.addEventListener("click", () => {
      if (!state.selfie.approved) return;
      buildQuizFlow();
      goTo("view-quiz");
      renderQuestion();
    });

    /* ---------- Quiz Model ---------- */
    // Paletas finais permitidas
    const PALETTES = [
      // warm
      "Primavera Clara", "Primavera Quente", "Primavera Quente Oliva", "Primavera Brilhante",
      "Outono Suave", "Outono Quente", "Outono Quente Oliva", "Outono Profundo", "Outono Profundo Oliva",
      // cool
      "Verão Claro", "Verão Suave", "Verão Frio", "Verão Frio Oliva",
      "Inverno Brilhante", "Inverno Frio", "Inverno Frio Oliva", "Inverno Profundo", "Inverno Profundo Oliva",
      // olive gates
      "Oliva Quente", "Oliva Frio"
    ];

    // Helpers groups
    const groupWarm = ["Primavera Clara", "Primavera Quente", "Primavera Brilhante", "Outono Suave", "Outono Quente", "Outono Profundo"];
    const groupCool = ["Verão Claro", "Verão Suave", "Verão Frio", "Inverno Brilhante", "Inverno Frio", "Inverno Profundo"];
    const allAutumns = ["Outono Suave", "Outono Quente", "Outono Profundo", "Outono Quente Oliva", "Outono Profundo Oliva"];
    const allSummers = ["Verão Claro", "Verão Suave", "Verão Frio", "Verão Frio Oliva"];
    const allWinters = ["Inverno Brilhante", "Inverno Frio", "Inverno Profundo", "Inverno Frio Oliva", "Inverno Profundo Oliva"];

    function scoreInit() {
      const obj = {};
      PALETTES.forEach(p => obj[p] = 0);
      return obj;
    }

    // Quiz Questions (base) with ultra-visual options
    // NOTE: scoring mapping follows user-provided mapping. (PDF describes methodology gates; mapping was provided in chat.)
    // NOTE: Scoring logic is now fully contained in scoreEngine.js based on answer keys.
    // The visual questions below provide the keys. 
    const QUESTIONS = [
      {
        id: "q1",
        title: "Seus olhos são...",
        help: "Observe a cor em luz natural.",
        layout: "cols3",
        options: [
          { key: "A", label: "Castanhos escuros / preto", sub: "Profundo", swatch: { bg: "url('assets/Q1-A.jpg') center/cover no-repeat" } }, { key: "B", label: "Castanhos médios / claros / mel", sub: "Amendoado", swatch: { bg: "url('assets/Q1-B.jpg') center/cover no-repeat" } }, { key: "C", label: "Avelã / oliva", sub: "Mistura verde-castanho", swatch: { bg: "url('assets/Q1-C.jpg') center/cover no-repeat" } }, { key: "D", label: "Verdes", sub: "Verde claro ou médio", swatch: { bg: "url('assets/Q1-D.jpg') center/cover no-repeat" } }, { key: "E", label: "Azuis / Cinzas", sub: "Frio", swatch: { bg: "url('assets/Q1-E.jpg') center/cover no-repeat" } }
        ]
      },
      {
        id: "q2",
        title: "Observe a cor da esclera dos seus olhos (o branco do olho).",
        help: "",
        layout: "cols2",
        options: [
          { key: "A", label: "É branco muito claro, iluminado", sub: "", swatch: { bg: "url('assets/Q2-A.jpg') center/cover no-repeat" } }, { key: "B", label: "É mais suave, como um off-white ou marfim claro", sub: "", swatch: { bg: "url('assets/Q2-B.jpg') center/cover no-repeat" } }
        ]
      },
      {
        id: "q3",
        title: "A borda da íris de todos nós tem um desenho. Como é a borda da sua íris, olhando de perto?",
        help: "",
        layout: "cols2",
        options: [
          { key: "A", label: "A borda da minha íris parece uma maquiagem esfumada", sub: "Degradê suave", swatch: { bg: "url('assets/Q3-A.jpg') center/cover no-repeat" } }, { key: "B", label: "A borda da íris é tão bem delimitada, que parece desenhada à caneta", sub: "Contraste alto", swatch: { bg: "url('assets/Q3-B.jpg') center/cover no-repeat" } }
        ]
      },
      {
        id: "q4",
        title: "A cor natural da raiz do seu cabelo, sem tintura é?",
        layout: "cols2",
        options: [
          { key: "a", label: "Preto azulado (vívido)", sub: "", swatch: { bg: "url('assets/Q4-A.jpg') center/cover no-repeat" } }, { key: "b", label: "Castanho escuro", sub: "", swatch: { bg: "url('assets/Q4-B.jpg') center/cover no-repeat" } }, { key: "c", label: "Castanho médio", sub: "", swatch: { bg: "url('assets/Q4-C.jpg') center/cover no-repeat" } }, { key: "d", label: "Castanho claro / mel", sub: "", swatch: { bg: "url('assets/Q4-D.jpg') center/cover no-repeat" } }, { key: "e", label: "Loiro escuro acinzentado", sub: "", swatch: { bg: "url('assets/Q4-E.jpg') center/cover no-repeat" } }, { key: "f", label: "Loiro médio / claro", sub: "", swatch: { bg: "url('assets/Q4-F.jpg') center/cover no-repeat" } }, { key: "g", label: "Ruivo claro alaranjado", sub: "", swatch: { bg: "url('assets/Q4-G.jpg') center/cover no-repeat" } }, { key: "h", label: "Ruivo médio", sub: "", swatch: { bg: "url('assets/Q4-H.jpg') center/cover no-repeat" } }
        ]
      },
      {
        id: "q5",
        title: "Observe, em luz fria (branca), qual a cor predominante das veias na parte interna do seu punho.",
        help: "",
        layout: "cols3",
        options: [
          { key: "A", label: "Azul ou roxo", sub: "", swatch: { bg: "url('assets/Q5-A.jpg') center/cover no-repeat" } }, { key: "B", label: "Esverdeada", sub: "", swatch: { bg: "url('assets/Q5-B.jpg') center/cover no-repeat" } }, { key: "C", label: "Não consigo ver as veias claramente", sub: "Difícil distinguir", swatch: { type: "block", bg: "#bdc3c7" } }
        ]
      },
      {
        id: "q6",
        title: "Você tem sardas visíveis, sem maquiagem?",
        help: "",
        layout: "cols2",
        options: [
          { key: "A", label: "Não tenho sardas.", sub: "", swatch: { bg: "url('assets/Q6-A.jpg') center/cover no-repeat" } }, { key: "B", label: "Sim. Elas são claras, em um tom de dourado.", sub: "", swatch: { bg: "url('assets/Q6-B.jpg') center/cover no-repeat" } }, { key: "C", label: "Sim. Elas são na cor caramelo.", sub: "", swatch: { bg: "url('assets/Q6-C.jpg') center/cover no-repeat" } }, { key: "D", label: "Sim. Elas têm um tom de marrom acinzentado.", sub: "", swatch: { bg: "url('assets/Q6-D.jpg') center/cover no-repeat" } }
        ]
      },
      {
        id: "q7",
        title: "Quando você faz esforço físico, a sua pele tende a ficar vermelha em áreas como bochecha, nariz ou no peito?",
        layout: "cols2",
        options: [
          { key: "A", label: "Sim, facilmente", sub: "Fica rosada rápido" }, { key: "B", label: "Às vezes, só com esforço extremo", sub: "" }, { key: "C", label: "Raramente / nunca", sub: "" }, { key: "D", label: "Minha pele escurece ou fica arroxeada", sub: "" }
        ]
      },
      {
        id: "q8",
        title: "Você tem olheiras, mesmo quando NÃO está cansada?",
        help: "",
        layout: "cols2",
        options: [
          { key: "A", label: "Só tenho olheiras quando cansada.", sub: "", swatch: { bg: "url('assets/Q8-A.jpg') center/cover no-repeat" } }, { key: "B", label: "Sim, mas são uma sombra por causa do formato natural.", sub: "", swatch: { bg: "url('assets/Q8-B.jpg') center/cover no-repeat" } }, { key: "C", label: "Sim, são castanhas ou caramelo.", sub: "", swatch: { bg: "url('assets/Q8-C.jpg') center/cover no-repeat" } }, { key: "D", label: "Sim, são levemente azuladas ou ameixa.", sub: "", swatch: { bg: "url('assets/Q8-D.jpg') center/cover no-repeat" } }, { key: "E", label: "Sim, são esverdeadas ou acinzentadas.", sub: "", swatch: { bg: "url('assets/Q8-E.jpg') center/cover no-repeat" } }
        ]
      },
      {
        id: "q9",
        title: "Quando sua pele bronzeia, qual opção melhor descreve o tom que ela adquire?",
        layout: "wide",
        options: [
          { key: "A", label: "Nunca consegui bronzear.", sub: "" },
          { key: "B", label: "Um tom dourado-chá, mostarda escura ou âmbar", sub: "", swatch: { bg: "url('assets/Q9-B.png') center/cover no-repeat" } },
          { key: "C", label: "Um tom levemente acinzentado: cáqui ou grafite esverdeado", sub: "", swatch: { bg: "url('assets/Q9-C.png') center/cover no-repeat" } },
          { key: "D", label: "Um tom dourado luminoso: pêssego dourado, caramelo dourado ou cobre escuro", sub: "", swatch: { bg: "url('assets/Q9-D.png') center/cover no-repeat" } },
          { key: "E", label: "Um tom levemente arroxeado, malva ou vinho.", sub: "", swatch: { bg: "url('assets/Q9-E.png') center/cover no-repeat" } }
        ]
      },
      {
        id: "q10",
        title: "O tom natural da minha pele, quando NÃO estou bronzeada é...",
        layout: "cols2",
        options: [
          { key: "A", label: "Um tom que tende ao rosado.", sub: "" },
          { key: "B", label: "Um tom que tende ao amarelo-dourado.", sub: "" },
          { key: "C", label: "Se eu ficar muito tempo sem tomar sol, minha pele fica em um tom amarelo-esverdeado.", sub: "" },
          { key: "D", label: "Se eu ficar muito tempo sem tomar sol, minha pele fica em um tom levemente acinzentado.", sub: "" }
        ]
      },
      {
        id: "q11",
        title: "Ao experimentar diferentes cores de corretivos ou bases...",
        help: "",
        layout: "cols2",
        options: [
          { key: "A", label: "Já tive experiência do produto deixar minha pele acinzentada ou alaranjada.", sub: "Aspecto estranho" }, { key: "B", label: "Não sei. ", sub: "Neutro" }, { key: "C", label: "Sei que as bases com fundo rosado combinam com minha pele", sub: "Frio" }, { key: "D", label: "Sei que as bases com fundo dourado combinam com minha pele.", sub: "Quente" }, { key: "E", label: "Sei que as bases com fundo neutro combinam com meu tom de pele.", sub: "Neutro" }
        ]
      },
      {
        id: "q12",
        title: "Qual tom de pele mais se assemelha ao seu?",
        help: "",
        layout: "poster",
        options: [
          { key: "A", label: "Minha pele é clara", sub: "", swatch: { bg: "url('assets/Q12-A.jpg') center/cover no-repeat" } },
          { key: "B", label: "Minha pele é média.", sub: "", swatch: { bg: "url('assets/Q12-B.jpg') center/cover no-repeat" } },
          { key: "C", label: "Minha pele é morena", sub: "", swatch: { bg: "url('assets/Q12-C.jpg') center/cover no-repeat" } },
          { key: "D", label: "Minha pele é profunda", sub: "", swatch: { bg: "url('assets/Q12-D.jpg') center/cover no-repeat" } }
        ]
      }

    ];

    // --- Frame Data for Dynamic Q13 ---
    const FRAMES_DATA = {
      spring: {
        title: "Teste final (Primaveras) — qual moldura suaviza sombras?",
        help: "Brilho máximo. Escolha a moldura que ilumina sem estourar.",
        options: [
          { key: "A", label: "Primavera Clara", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#ffb3a7,#fff1b8)" } },
          { key: "B", label: "Primavera Quente", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#ffbf69,#ff8e54)" } },
          { key: "C", label: "Primavera Brilhante", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#ff3b30,#ff7a5a)" } }
        ]
      },
      summer: {
        title: "Teste final (Verões) — qual moldura suaviza sombras?",
        help: "Brilho da tela no máximo. Escolha a moldura que deixa sombras menores e aparência mais leve.",
        options: [
          { key: "A", label: "Verão Claro", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#f2c6d1,#E6DDEE)" } },
          { key: "B", label: "Verão Suave", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#C9A3B0,#AFC1CC)" } },
          { key: "C", label: "Verão Frio", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#C48793,#9E8BB5)" } }
        ]
      },
      autumn: {
        title: "Teste final (Outonos) — qual moldura suaviza sombras?",
        help: "Brilho máximo. Escolha a moldura que deixa o rosto mais harmonioso e “rico”, sem acinzentar.",
        options: [
          { key: "A", label: "Outono Suave", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#f3b096,#eac792)" } },
          { key: "B", label: "Outono Quente", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#b87333,#e05e16)" } },
          { key: "C", label: "Outono Profundo", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#710f19,#714732)" } },
          { key: "D", label: "Oliva Quente", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#525834,#908e17)" } }
        ]
      },
      winter: {
        title: "Teste final (Invernos) — qual moldura suaviza sombras?",
        help: "Brilho máximo. Escolha a moldura que deixa o rosto mais definido e elegante, sem apagar.",
        options: [
          { key: "A", label: "Inverno Brilhante", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#d81b81,#930028)" } },
          { key: "B", label: "Inverno Frio", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#ffbf69,#ff8e54)" } },
          { key: "C", label: "Inverno Profundo (Não Oliva)", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#4a0f24,#3e1f47)" } },
          { key: "D", label: "Inverno Profundo Oliva", sub: "", swatch: { type: "block", bg: "linear-gradient(135deg,#7b1e67,#003b44)" } }
        ]
      }
    };

    function buildQuizFlow() {
      // Base flow = Q1-Q11 + Final Frame (Dynamic Q13)
      state.quiz.answers = {};
      state.quiz.cursor = 0;

      const base = [...QUESTIONS];

      // Dynamic Final Frame (Q13) placeholder
      // The options will be populated in renderQuestion based on preliminary score.
      base.push({
        id: "frame",
        title: "Em qual imagem as sombras suavizaram e parecem mais iluminadas?",
        help: "Perceba o tamanho de cada sombra no seu rosto (olheiras, bochechas, etc.)",
        layout: "grid-faces",
        options: [] // Filled dynamically
      });

      state.quiz.flow = base;
    }

    function currentQuestion() { return state.quiz.flow[state.quiz.cursor]; }

    function setGridCols(cls) {
      const el = $("#qOptions");
      el.className = "optionsGrid";
      if (cls === "cols3") el.classList.add("cols3");
      if (cls === "cols4") el.classList.add("cols4");
      if (cls === "poster") el.classList.add("poster");
      if (cls === "wide") el.classList.add("wide");
    }


    /* ---------- Public UI text (hide scoring hints) ---------- */
    const HELP_OVERRIDES = {
      q6: "Se você tiver sardas, selecione a alternativa que mais se parece com as suas em luz natural.",
      q7: "Selecione a alternativa que descreve melhor sua reação ao esforço físico.",
      q8: "Selecione a alternativa que descreve melhor a aparência das suas olheiras em dias normais.",
      q9: "Selecione a reação mais comum da sua pele ao sol (sem filtros).",
      q10: "Selecione a alternativa que descreve melhor como você percebe o tom da sua pele.",
      frame: "Perceba o tamanho de cada sombra no seu rosto (olheiras, bochechas, etc.)"
    };

    function getPublicTitle(q) {
      if (q.id === "frame") return "Qual moldura suaviza as sombras no seu rosto?";
      return q.title || "";
    }

    function getPublicHelp(q) {
      return HELP_OVERRIDES[q.id] || (q.help || "");
    }

    function getPublicOptionLabel(q, opt) {
      if (q.id === "frame") return `Moldura ${opt.key}`;
      return opt.label || "";
    }

    function getPublicOptionSub(q, opt) {
      if (q.id === "q11" || q.id === "q12" || q.id === "frame") return "";
      const sub = opt.sub || "";
      if (!sub) return "";
      // Hide anything that looks like scoring guidance or palette hints
      if (/pontua|favorece|tende|primavera|verão|verao|outono|inverno|oliva|quente|frio|#|desempate|temperatura/i.test(sub)) return "";
      return sub;
    }

    function predictSeasonGroup(ans) {
      // Simplified scoring to determine just the season family (Standard vs Dynamic Frame)
      // We reuse the logic from scoreEngine but stripping it down to families
      const s = {};
      PALETTES.forEach(p => s[p] = 0);

      // Helper to add points
      const add = (p, v) => { if (s[p] !== undefined) s[p] += v; };
      const addList = (list, v) => list.forEach(p => add(p, v));

      if (ans.q1 === "A") { add("Inverno Profundo", 2); add("Outono Profundo", 2); }
      if (ans.q1 === "B") { add("Primavera Quente", 1); add("Outono Quente", 1); add("Oliva Quente", 1); }
      if (ans.q1 === "C") { addList(allAutumns, 1); add("Primavera Quente", 1); }
      if (ans.q1 === "D") { add("Primavera Quente", 1); addList(allSummers, 1); } // Green eyes -> diverse
      if (ans.q1 === "E") { addList(allSummers, 1); addList(allWinters, 1); }

      // Q4 Hair is strong indicator
      if (ans.q4 === "a") { add("Inverno Profundo", 3); add("Inverno Brilhante", 2); }
      if (ans.q4 === "b") { add("Inverno Profundo", 2); add("Outono Profundo", 2); }
      if (ans.q4 === "c") { add("Outono Quente", 1); add("Primavera Quente", 1); }
      if (ans.q4 === "d") { add("Primavera Quente", 2); add("Outono Suave", 1); }
      if (ans.q4 === "e") { add("Verão Suave", 2); add("Verão Frio", 1); }
      if (ans.q4 === "f") { add("Primavera Clara", 2); add("Verão Claro", 2); }
      if (ans.q4 === "g") { add("Primavera Quente", 3); }
      if (ans.q4 === "h") { add("Outono Quente", 3); add("Outono Profundo", 2); }

      // Q10 Skin
      if (ans.q10 === "A") { addList(allWinters, 1); addList(allSummers, 1); }
      if (ans.q10 === "B") { addList(allAutumns, 1); addList(allSummers, 0); /* typo in logic above? sticking to warm */ add("Primavera Quente", 2); }
      if (ans.q10 === "C" || ans.q10 === "D") {
        // Olivas often map to Autumn (Warm) or Winter (Cool)
        if (ans.q10 === "C") add("Oliva Quente", 3);
        if (ans.q10 === "D") add("Oliva Frio", 3);
      }

      // Count totals by family
      const families = { spring: 0, summer: 0, autumn: 0, winter: 0 };

      Object.keys(s).forEach(k => {
        if (k.includes("Primavera")) families.spring += s[k];
        if (k.includes("Verão") || k.includes("Verao")) families.summer += s[k];
        // CORREÇÃO: Olivas contam para Outono/Inverno para verem a moldura correta
        if (k.includes("Outono") || k === "Oliva Quente") families.autumn += s[k];
        if (k.includes("Inverno") || k === "Oliva Frio" || k.includes("Oliva") && k.includes("Inverno")) families.winter += s[k];
      });

      // Pick winner
      let best = "winter";
      let max = -1;
      for (const [fam, val] of Object.entries(families)) {
        if (val > max) { max = val; best = fam; }
      }

      return best;
    }

    function renderQuestion() {
      const q = currentQuestion();
      if (!q) return;

      // --- Logic Update: Dynamic Q13 Handling (Unified) ---
      if (q.id === "frame") {
        try {
          // Always recalculate to ensure consistency if user navigates back
          const group = predictSeasonGroup(state.quiz.answers);

          // Persist frameGroup for backend
          state.quiz.answers.frameGroup = group;

          const data = FRAMES_DATA[group] || FRAMES_DATA["winter"];
          q.title = data.title;
          q.help = data.help;
          q.options = data.options;

          // Don't apply stack-3 here, let CSS handle it via class or if necessary
          q.layout = "grid-faces";

        } catch (e) {
          console.error("Error calculating frame group", e);
          const data = FRAMES_DATA["winter"];
          q.options = data.options;
          q.layout = "grid-faces";
        }
      }

      $("#qTitle").textContent = getPublicTitle(q);
      $("#qHelp").textContent = getPublicHelp(q);
      const visibleIndex = state.quiz.cursor + 1;
      $("#qMeta").textContent = `Pergunta ${visibleIndex} de ${state.quiz.flow.length}`;

      setGridCols(q.layout || "cols2");

      const wrap = $("#qOptions");
      wrap.innerHTML = "";

      // Special layout for face grid (Second Image Style)
      if (q.layout === "grid-faces") {
        wrap.className = "grid-faces";

        // Se houver exatamente 3 opções, empilhamos verticalmente para dar foco total às cores
        if (q.options.length === 3) {
          wrap.classList.add("stack-3");
        }

        q.options.forEach(opt => {
          const card = document.createElement("div");
          card.className = "faceCard";

          // Cor de fundo vinda da paleta da pergunta
          const bg = opt.swatch?.bg || "#ccc";
          card.style.background = bg;

          const img = document.createElement("img");
          img.src = state.selfie.croppedDataUrl || state.selfie.dataUrl;
          img.alt = opt.label;

          card.appendChild(img);

          const chosen = state.quiz.answers[q.id] === opt.key;
          if (chosen) card.classList.add("selected");

          card.onclick = () => {
            state.quiz.answers[q.id] = opt.key;
            $$(".faceCard", wrap).forEach(c => c.classList.remove("selected"));
            card.classList.add("selected");
            $("#qHint").classList.remove("show");
          };

          wrap.appendChild(card);
        });
        return;
      }

      q.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "opt";
        btn.setAttribute("data-key", opt.key);
        const publicLabel = getPublicOptionLabel(q, opt);
        btn.setAttribute("aria-label", publicLabel);

        const wantsFace = Boolean(state?.selfie?.dataUrl) && (q.id === "frame");

        if (opt.swatch || wantsFace) {
          const sw = document.createElement("div");
          sw.className = "swatch" + (opt.swatch?.type === "eye" ? " eye" : "") + (wantsFace ? " faceSwatch" : "");
          sw.style.background = opt.swatch?.bg || "linear-gradient(135deg,#fff,#edf0f6)";

          if (opt.swatch?.type === "icon" && opt.swatch?.svg) {
            sw.style.background = "transparent";
            sw.classList.add("iconSwatch");
            sw.innerHTML = opt.swatch.svg;
          }

          if (wantsFace) {
            const img = document.createElement("img");
            img.className = "swatchFace";
            img.src = state.selfie.croppedDataUrl || state.selfie.dataUrl;
            img.alt = "Rosto do usuário";
            sw.appendChild(img);

            if (q.id === "q11") {
              const ov = document.createElement("div");
              ov.className = "faceTint";
              ov.style.background = opt.swatch?.tint || "rgba(0,0,0,.08)";
              sw.appendChild(ov);
            }
          }
          btn.appendChild(sw);
        } else {
          // No swatch -> Center text mode (UX request)
          btn.classList.add("text-centered");
        }

        const txt = document.createElement("div");
        txt.className = "txt";
        const publicSub = getPublicOptionSub(q, opt);
        txt.innerHTML = `<strong>${opt.key}) ${publicLabel}</strong>` + (publicSub ? `<span>${publicSub}</span>` : ``);
        btn.appendChild(txt);

        const chosen = state.quiz.answers[q.id] === opt.key;
        if (chosen) btn.classList.add("selected");

        btn.addEventListener("click", (ev) => {
          // select
          state.quiz.answers[q.id] = opt.key;
          $$(".opt", wrap).forEach(b => b.classList.toggle("selected", b.getAttribute("data-key") === opt.key));
          $("#qHint").classList.remove("show");
          // ripple
          addRipple(btn, ev);
        });

        wrap.appendChild(btn);
      });

      $("#btnPrevQ").disabled = state.quiz.cursor === 0;
      $("#btnPrevQ").style.opacity = state.quiz.cursor === 0 ? ".6" : "1";
      $("#btnPrevQ").style.cursor = state.quiz.cursor === 0 ? "not-allowed" : "pointer";
    }

    $("#btnPrevQ").addEventListener("click", () => {
      if (state.quiz.cursor === 0) return;
      state.quiz.cursor--;
      renderQuestion();
    });

    $("#btnNextQ").addEventListener("click", () => {
      const q = currentQuestion();
      const ans = state.quiz.answers[q.id];
      if (!ans) {
        $("#qHint").classList.add("show");
        return;
      }

      // Q12 is now fixed (skin tone) - no dynamic injection needed

      // Q12 is now fixed (skin tone) - no dynamic injection needed
      // REMOVED: Competing logic that injected frame after Q12.
      // Q13 (frame) is now always handled dynamically in renderQuestion().

      // advance
      if (state.quiz.cursor < state.quiz.flow.length - 1) {
        state.quiz.cursor++;
        renderQuestion();
      } else {
        // finish quiz -> loading -> scanner -> result
        goTo("view-loading");
        runAnalysisPipeline();
      }
    });

    // getQ12Warm removed - Q12 is now fixed
    // getQ12Cool removed - Q12 is now fixed

    function getFrameForGroup(group) {
      if (group === "spring") return {
        id: "frame",
        title: "Teste final (Primaveras)",
        help: "Escolha a opção que deixa o rosto mais iluminado e saudável.",
        layout: "grid-faces",
        options: [
          { key: "A", label: "Primavera Clara", swatch: { bg: "linear-gradient(135deg,#ffb3a7,#fff1b8)" } },
          { key: "B", label: "Primavera Quente", swatch: { bg: "linear-gradient(135deg,#ffbf69,#ff8e54)" } },
          { key: "C", label: "Primavera Brilhante", swatch: { bg: "linear-gradient(135deg,#ff3b30,#ff7a5a)" } }
        ],
        score: (ans, s) => {
          if (ans === "A") s["Primavera Clara"] += 3;
          if (ans === "B") s["Primavera Quente"] += 3;
          if (ans === "C") s["Primavera Brilhante"] += 3;
        }
      };
      if (group === "summer") return {
        id: "frame",
        title: "Teste final (Verões)",
        help: "Escolha a opção que deixa o rosto mais leve e elegante.",
        layout: "grid-faces",
        options: [
          { key: "A", label: "Verão Claro", swatch: { bg: "linear-gradient(135deg,#f2c6d1,#E6DDEE)" } },
          { key: "B", label: "Verão Suave", swatch: { bg: "linear-gradient(135deg,#C9A3B0,#AFC1CC)" } },
          { key: "C", label: "Verão Frio", swatch: { bg: "linear-gradient(135deg,#C48793,#9E8BB5)" } }
        ],
        score: (ans, s) => {
          if (ans === "A") s["Verão Claro"] += 3;
          if (ans === "B") s["Verão Suave"] += 3;
          if (ans === "C") s["Verão Frio"] += 3;
        }
      };
      if (group === "winter") return {
        id: "frame",
        title: "Teste final (Invernos)",
        help: "Escolha a opção que melhora a definição sem apagar o rosto.",
        layout: "grid-faces",
        options: [
          { key: "A", label: "Inverno Brilhante", swatch: { bg: "linear-gradient(135deg,#d81b81,#930028)" } },
          { key: "B", label: "Inverno Frio", swatch: { bg: "linear-gradient(135deg,#7b1e3a,#003b44)" } },
          { key: "C", label: "Inverno Profundo", swatch: { bg: "linear-gradient(135deg,#1612d3,#950095)" } },
          { key: "D", label: "Inverno Ol. Profundo", swatch: { bg: "linear-gradient(135deg,#7b1e67,#003b44)" } }
        ],
        score: (ans, s) => {
          if (ans === "A") s["Inverno Brilhante"] += 3;
          if (ans === "B") s["Inverno Frio"] += 3;
          if (ans === "C") s["Inverno Profundo"] += 3;
          if (ans === "D") s["Inverno Profundo Oliva"] += 3;
        }
      };
      // Autumn
      return {
        id: "frame",
        title: "Teste final (Outonos)",
        help: "Escolha a opção que deixa o rosto mais harmônico e “rico”.",
        layout: "grid-faces",
        options: [
          { key: "A", label: "Outono Suave", swatch: { bg: "linear-gradient(135deg,#f3b096,#eac792)" } },
          { key: "B", label: "Outono Quente", swatch: { bg: "linear-gradient(135deg,#b87333,#e05e16)" } },
          { key: "C", label: "Outono Profundo", swatch: { bg: "linear-gradient(135deg,#ff3b30,#ff7a5a)" } },
          { key: "D", label: "Oliva Quente", swatch: { bg: "linear-gradient(135deg,#525834,#908e17)" } }
        ],
        score: (ans, s) => {
          if (ans === "A") s["Outono Suave"] += 3;
          if (ans === "B") s["Outono Quente"] += 3;
          if (ans === "C") s["Outono Profundo"] += 3;
          if (ans === "D") s["Oliva Quente"] += 3;
        }
      };
    }

    function computePreTemperature() {
      // quick heuristic from answered parts (veins + olive statement + sun reaction)
      const a = state.quiz.answers;
      let warm = 0, cool = 0;
      if (a.q5 === "A") cool += 2;
      if (a.q5 === "B") warm += 2;
      if (a.q10 === "A") cool += 1;
      if (a.q10 === "B") warm += 1;
      if (a.q9 === "A") cool += 1;
      if (a.q9 === "D") warm += 1;
      // if olive triggers present, keep warm by default (safer for q12 choice); still allow cool if strong
      return (cool > warm) ? "cool" : "warm";
    }

    function computeScores(answers) {
      const s = scoreInit();
      for (const q of state.quiz.flow) {
        if (!q || !q.score) continue;
        const ans = answers[q.id];
        if (!ans) continue;
        q.score(ans, s);
      }
      return s;
    }

    function dominantSeasonGroup(scores) {
      // Determine dominant among spring/summer/autumn/winter by summing core subtypes
      const sum = (arr) => arr.reduce((acc, k) => acc + (scores[k] || 0), 0);
      const spring = sum(["Primavera Clara", "Primavera Quente", "Primavera Brilhante"]);
      const summer = sum(["Verão Claro", "Verão Suave", "Verão Frio"]);
      const autumn = sum(["Outono Suave", "Outono Quente", "Outono Profundo"]);
      const winter = sum(["Inverno Brilhante", "Inverno Frio", "Inverno Profundo"]);
      const max = Math.max(spring, summer, autumn, winter);
      if (max === spring) return "spring";
      if (max === summer) return "summer";
      if (max === winter) return "winter";
      return "autumn";
    }

    // Max points table (from user-provided summary)
    const MAX_POINTS_WARM = {
      "Primavera Clara": 11,
      "Primavera Quente": 17,
      "Primavera Brilhante": 5,
      "Outono Suave": 13,
      "Outono Quente": 20,
      "Outono Profundo": 17
    };
    const MAX_POINTS_COOL = {
      "Verão Claro": 8,
      "Verão Suave": 11,
      "Verão Frio": 8,
      "Inverno Brilhante": 9,
      "Inverno Frio": 6,
      "Inverno Profundo": 12
    };

    function applyOliveGate(scores) {
      const oliveWarm = scores["Oliva Quente"] || 0;
      const oliveCool = scores["Oliva Frio"] || 0;

      let mode = "none"; // "warm" | "cool"
      if (oliveWarm >= 13) mode = "warm";
      if (oliveCool >= 13) mode = "cool";

      // if both pass, choose higher
      if (oliveWarm >= 13 && oliveCool >= 13) {
        mode = oliveWarm >= oliveCool ? "warm" : "cool";
      }

      return { mode, oliveWarm, oliveCool };
    }

    function threshold60Filter(scores, allowed) {
      // allowed: list of palettes to consider
      const passed = [];
      for (const pal of allowed) {
        const max = MAX_POINTS_WARM[pal] ?? MAX_POINTS_COOL[pal];
        if (!max) continue;
        const min = Math.ceil(max * 0.60);
        if ((scores[pal] || 0) >= min) {
          passed.push(pal);
        }
      }
      return passed;
    }

    function tiebreak(choices, scores, answers) {
      // Hierarchy:
      // 1) sclera + iris edge (q2 + q3)
      // A: very white + sharp edge -> favors Brilhantes & Profundos
      // B: offwhite + soft edge -> favors Suaves & Claros
      const q2 = answers.q2; // A/B
      const q3 = answers.q3; // A/B
      const tiebreakers = [];

      const favorsDeepBright = (q2 === "A" && q3 === "B");
      const favorsSoftLight = (q2 === "B" && q3 === "A");

      if (choices.length <= 1) return { winner: choices[0], tiebreakers };

      tiebreakers.push("sclera_iris");
      if (favorsDeepBright) {
        const deepOrBright = choices.filter(p => /Profundo|Brilhante/.test(p));
        if (deepOrBright.length === 1) return { winner: deepOrBright[0], tiebreakers };
        if (deepOrBright.length > 1) choices = deepOrBright;
      } else if (favorsSoftLight) {
        const softOrLight = choices.filter(p => /Suave|Claro/.test(p));
        if (softOrLight.length === 1) return { winner: softOrLight[0], tiebreakers };
        if (softOrLight.length > 1) choices = softOrLight;
      }

      if (choices.length <= 1) return { winner: choices[0], tiebreakers };

      // 2) rubor (q7)
      tiebreakers.push("rubor");
      const q7 = answers.q7;
      if (q7 === "A") {
        // favors verões + invernos (cool)
        const cool = choices.filter(p => /Verão|Inverno/.test(p));
        if (cool.length === 1) return { winner: cool[0], tiebreakers };
        if (cool.length > 1) choices = cool;
      } else if (q7 === "C") {
        // favors outonos / oliva quente
        const warm = choices.filter(p => /Outono|Oliva/.test(p));
        if (warm.length === 1) return { winner: warm[0], tiebreakers };
        if (warm.length > 1) choices = warm;
      }

      if (choices.length <= 1) return { winner: choices[0], tiebreakers };

      // 3) dark circles + freckles (q8 + q6)
      tiebreakers.push("freckles_darkcircles");
      const q8 = answers.q8;
      const q6 = answers.q6;

      if (q8 === "C" || q6 === "C") {
        // caramel/brown leans autumn
        const autumn = choices.filter(p => /Outono/.test(p));
        if (autumn.length === 1) return { winner: autumn[0], tiebreakers };
        if (autumn.length > 1) choices = autumn;
      }
      if (q8 === "D") {
        // bluish leans summer/winter
        const cool = choices.filter(p => /Verão|Inverno/.test(p));
        if (cool.length === 1) return { winner: cool[0], tiebreakers };
        if (cool.length > 1) choices = cool;
      }
      if (q8 === "E" || q6 === "D") {
        // gray/green leans olive
        const olive = choices.filter(p => /Oliva/.test(p));
        if (olive.length === 1) return { winner: olive[0], tiebreakers };
        if (olive.length > 1) choices = olive;
      }

      // Final fallback: highest score
      let best = choices[0];
      for (const p of choices) {
        if ((scores[p] || 0) > (scores[best] || 0)) best = p;
      }
      return { winner: best, tiebreakers };
    }

    function finalizePalette(scores, answers) {
      const { mode, oliveWarm, oliveCool } = applyOliveGate(scores);

      let allowed = [];
      let category = "warm";
      let variant = "non-olive";

      if (mode === "warm") {
        category = "warm";
        variant = "olive";
        // When oliva warm gate triggers, consider only these (as per user summary)
        allowed = ["Primavera Quente", "Outono Suave", "Outono Quente", "Outono Profundo"];
      } else if (mode === "cool") {
        category = "cool";
        variant = "olive";
        // When oliva cool gate triggers
        allowed = ["Verão Frio", "Verão Suave", "Inverno Frio", "Inverno Profundo"];
      } else {
        // consider all 12
        allowed = [...groupWarm, ...groupCool];
        // category will be determined by the final palette
      }

      // apply 60% threshold
      const passed = threshold60Filter(scores, allowed);
      // if none passed, pick best in allowed (demo fallback)
      let candidates = passed.length ? passed : allowed;

      // choose max score
      let topScore = -Infinity;
      let tops = [];
      candidates.forEach(p => {
        const sc = scores[p] || 0;
        if (sc > topScore) { topScore = sc; tops = [p]; }
        else if (sc === topScore) { tops.push(p); }
      });

      // tiebreak
      const tb = tiebreak(tops, scores, answers);
      let chosen = tb.winner || tops[0];

      // decide category/variant and olive suffixes (final naming)
      const isWarm = /Primavera|Outono/.test(chosen);
      category = isWarm ? "warm" : "cool";

      // olive variants in final list:
      // - if olive gate triggered, we label as "X Oliva" (where applicable)
      // - if no gate, keep non-olive as chosen.
      if (mode === "warm") {
        // prefer "Outono Quente Oliva" etc if chosen is autumn
        if (chosen === "Outono Quente") chosen = "Outono Quente Oliva";
        if (chosen === "Outono Profundo") chosen = "Outono Profundo Oliva";
        if (chosen === "Primavera Quente") chosen = "Primavera Quente Oliva";
        // Outono Suave has no olive variant in list (we keep as is)
      }
      if (mode === "cool") {
        if (chosen === "Verão Frio") chosen = "Verão Frio Oliva";
        if (chosen === "Inverno Frio") chosen = "Inverno Frio Oliva";
        if (chosen === "Inverno Profundo") chosen = "Inverno Profundo Oliva";
        // Verão Suave has no olive variant in list
      }

      // confidence (demo): based on top margin
      const sorted = candidates.map(p => ({ p, s: scores[p] || 0 })).sort((a, b) => b.s - a.s);
      const margin = (sorted[0]?.s ?? 0) - (sorted[1]?.s ?? 0);
      const conf = Math.max(0.35, Math.min(0.95, 0.55 + margin * 0.05));

      // Map palette names to IDs for the Style Guide
      const ids = {
        "Primavera Clara": "spring_light",
        "Primavera Quente": "spring_true",
        "Primavera Quente Oliva": "spring_true", // fallback
        "Primavera Brilhante": "spring_bright",
        "Verão Claro": "summer_light",
        "Verão Suave": "summer_soft",
        "Verão Frio": "summer_true",
        "Verão Frio Oliva": "summer_true", // fallback
        "Outono Suave": "autumn_soft",
        "Outono Quente": "autumn_true",
        "Outono Quente Oliva": "autumn_true", // fallback
        "Outono Profundo": "autumn_deep",
        "Outono Profundo Oliva": "autumn_deep", // fallback
        "Inverno Brilhante": "winter_bright",
        "Inverno Frio": "winter_true",
        "Inverno Frio Oliva": "winter_true", // fallback
        "Inverno Profundo": "winter_deep",
        "Inverno Profundo Oliva": "winter_deep"  // fallback
      };

      const id = ids[chosen] || "spring_true"; // default fallback

      return {
        id,
        chosen,
        category,
        variant: (mode === "none" ? "non-olive" : "olive"),
        oliveWarm, oliveCool,
        gate: mode === "none" ? "failed" : "passed",
        threshold: passed.length ? "passed" : "failed",
        tiebreaker_used: tb.tiebreakers,
        topScore
      };
    }

    // --- DATABASE DE ESTILO ---
    // --- NOVO DATASET PREMIUM (Fonte da Verdade) ---
    const SEASONAL_DATA = {
      // 🌸 PRIMAVERA
      "spring_light": {
        title: "Primavera Clara (Light Spring)",
        theme: "from-yellow-50 to-pink-50 border-yellow-200",
        accent: "text-amber-500",
        desc: "Quente, claro e delicado. Sua beleza brilha com cores iluminadas pelo sol.",
        subtones: "Pêssego, Dourado suave.",
        neutrals: [
          { name: "Creme", hex: "#FFFDD0" }, { name: "Bege Dourado", hex: "#F5F5DC" },
          { name: "Cinza Quente", hex: "#AFAFAF" }, { name: "Marrom Claro", hex: "#C4A484" }
        ],
        highlights: [
          { name: "Pêssego", hex: "#FFDAB9" }, { name: "Coral Claro", hex: "#F08080" },
          { name: "Amarelo Manteiga", hex: "#FFFACD" }, { name: "Verde Claro", hex: "#90EE90" },
          { name: "Turquesa Suave", hex: "#AFEEEE" }
        ],
        makeup: { batom: "Coral rosado, Pêssego, Nude quente.", blush: "Pêssego ou Coral suave." },
        hair: "Loiro dourado, Castanho claro quente, Ruivo morango.",
        avoid: "Preto puro, cinzas frios, tons muito escuros e fechados.",
        contrast_guide: "Baixo a médio. Evite contrastes pesados que ofusquem sua delicadeza."
      },
      "spring_warm": {
        title: "Primavera Quente (True Spring)",
        theme: "from-orange-50 to-yellow-50 border-orange-300",
        accent: "text-orange-600",
        desc: "Quente puro, vibrante e cheio de energia. Cores vivas são essenciais.",
        subtones: "Dourado intenso, Mel.",
        neutrals: [
          { name: "Marrom Dourado", hex: "#966F33" }, { name: "Camel", hex: "#C19A6B" },
          { name: "Creme Rico", hex: "#F3E5AB" }, { name: "Azul Marinho Quente", hex: "#000080" }
        ],
        highlights: [
          { name: "Laranja", hex: "#FFA500" }, { name: "Tomate", hex: "#FF6347" },
          { name: "Dourado", hex: "#FFD700" }, { name: "Verde Vivo", hex: "#32CD32" },
          { name: "Coral Vivo", hex: "#FF7F50" }
        ],
        makeup: { batom: "Laranja, Coral vibrante, Vermelho tomate.", blush: "Coral ou Bronze." },
        hair: "Ruivo acobreado, Loiro mel, Castanho dourado.",
        avoid: "Tons frios azulados, rosados frios (fúcsia, bordô).",
        contrast_guide: "Médio. Você segura bem cores com vivacidade."
      },
      "spring_bright": {
        title: "Primavera Brilhante (Bright Spring)",
        theme: "from-rose-50 to-yellow-50 border-rose-400",
        accent: "text-rose-600",
        desc: "Quente neutro, intenso e contrastante. Uma mistura vibrante de Primavera com influência de Inverno.",
        subtones: "Neutro-quente, Brilhante.",
        neutrals: [
          { name: "Preto (com cor)", hex: "#2C2C2C" }, { name: "Cinza Chumbo", hex: "#333333" },
          { name: "Taupe", hex: "#483C32" }, { name: "Marrom Escuro", hex: "#654321" }
        ],
        highlights: [
          { name: "Coral Vibrante", hex: "#FF4040" }, { name: "Turquesa Forte", hex: "#00CED1" },
          { name: "Verde Lima", hex: "#32CD32" }, { name: "Rosa Quente", hex: "#FF69B4" },
          { name: "Amarelo Gema", hex: "#FFD700" }
        ],
        makeup: { batom: "Rosa vibrante, Coral intenso, Vermelho melancia.", blush: "Rosa quente." },
        hair: "Castanho escuro, Preto natural, Loiro platinado (se quente).",
        avoid: "Tons apagados, opacos, pastéis empoeirados.",
        contrast_guide: "Alto. Use blocos de cor (color blocking) sem medo."
      },

      // ☀️ VERÃO
      "summer_light": {
        title: "Verão Claro (Light Summer)",
        theme: "from-blue-50 to-pink-50 border-blue-200",
        accent: "text-sky-600",
        desc: "Frio, claro e etéreo. Cores suaves com frescor.",
        subtones: "Rosado, Azulado suave.",
        neutrals: [
          { name: "Cinza Claro", hex: "#D3D3D3" }, { name: "Azul Acinzentado", hex: "#B0C4DE" },
          { name: "Off-White", hex: "#F8F8FF" }, { name: "Areia Frio", hex: "#C2B280" }
        ],
        highlights: [
          { name: "Rosa Bebê", hex: "#FFB6C1" }, { name: "Azul Céu", hex: "#87CEEB" },
          { name: "Lilás", hex: "#C8A2C8" }, { name: "Menta Fria", hex: "#98FF98" },
          { name: "Framboesa Suave", hex: "#E30B5C" }
        ],
        makeup: { batom: "Rosa claro, Malva suave.", blush: "Rosa frio." },
        hair: "Loiro cinza claro, Loiro platinado perolado.",
        avoid: "Laranja, amarelo forte, marrom quente, preto pesado.",
        contrast_guide: "Baixo. Mantenha as combinações leves e fluidas."
      },
      "summer_soft": {
        title: "Verão Suave (Soft Summer)",
        theme: "from-slate-50 to-emerald-50 border-slate-300",
        accent: "text-slate-600",
        desc: "Frio neutralizado, suave e elegante. A estação mais complexa e sofisticada.",
        subtones: "Neutro-frio, Opaco.",
        neutrals: [
          { name: "Cinza Médio", hex: "#808080" }, { name: "Taupe Rosado", hex: "#BC987E" },
          { name: "Azul Marinho Suave", hex: "#4C516D" }, { name: "Cacau", hex: "#875F42" }
        ],
        highlights: [
          { name: "Malva", hex: "#E0B0FF" }, { name: "Cinza Azulado", hex: "#6699CC" },
          { name: "Verde Sálvia", hex: "#9DC183" }, { name: "Lavanda Empoeirada", hex: "#967BB6" },
          { name: "Bordô Suave", hex: "#800020" }
        ],
        makeup: { batom: "Nude rosado, Malva, Ameixa suave.", blush: "Rosa antigo." },
        hair: "Loiro cinza escuro (dirty blonde), Castanho claro cinza.",
        avoid: "Cores neon, vibrantes demais, preto puro, laranja.",
        contrast_guide: "Baixo a médio. O tom sobre tom (monocromático) fica incrível."
      },
      "summer_cool": {
        title: "Verão Frio (Cool Summer)",
        theme: "from-blue-50 to-indigo-50 border-blue-300",
        accent: "text-indigo-600",
        desc: "Frio puro, sereno e clássico. Evite qualquer calor na paleta.",
        subtones: "Azulado, Rosado puro.",
        neutrals: [
          { name: "Azul Marinho", hex: "#000080" }, { name: "Carvão", hex: "#36454F" },
          { name: "Branco Suave", hex: "#F5F5F5" }, { name: "Cinza Azulado", hex: "#778899" }
        ],
        highlights: [
          { name: "Azul Royal Suave", hex: "#4169E1" }, { name: "Rosa Frio", hex: "#FF69B4" },
          { name: "Violeta", hex: "#8A2BE2" }, { name: "Framboesa", hex: "#E30B5C" },
          { name: "Verde Esmeralda Frio", hex: "#008000" }
        ],
        makeup: { batom: "Rosa chiclete, Pink suave, Rubi.", blush: "Rosa frio." },
        hair: "Castanho cinza, Preto suave, Loiro platinado acinzentado.",
        avoid: "Dourados, laranjas, terrosos quentes (tijolo, mostarda).",
        contrast_guide: "Médio. Cores frias criam uma harmonia natural."
      },

      // 🍂 OUTONO
      "autumn_soft": {
        title: "Outono Suave (Soft Autumn)",
        theme: "from-stone-50 to-orange-50 border-stone-300",
        accent: "text-stone-600",
        desc: "Quente neutralizado, suave e natural. Uma mistura rica de terra e luz difusa.",
        subtones: "Neutro-quente, Oliva suave.",
        neutrals: [
          { name: "Camelo", hex: "#C19A6B" }, { name: "Caqui", hex: "#F0E68C" },
          { name: "Marrom Café", hex: "#4B3621" }, { name: "Creme", hex: "#FFFDD0" }
        ],
        highlights: [
          { name: "Oliva Claro", hex: "#808000" }, { name: "Terracota Suave", hex: "#E2725B" },
          { name: "Pêssego Queimado", hex: "#FFCC99" }, { name: "Salmão", hex: "#FA8072" },
          { name: "Verde Musgo", hex: "#8A9A5B" }
        ],
        makeup: { batom: "Nude pêssego, Terracota, Marrom rosado.", blush: "Pêssego bronze." },
        hair: "Castanho dourado suave, Loiro mel, Acobreado sutíl.",
        avoid: "Preto puro, cores frias vibrantes (pink, azul elétrico).",
        contrast_guide: "Médio-baixo. Texturas naturais e cores foscas favorecem muito."
      },
      "autumn_warm": {
        title: "Outono Quente (True Autumn)",
        theme: "from-orange-100 to-amber-50 border-orange-400",
        accent: "text-amber-700",
        desc: "Quente puro, rico e terroso. A essência das folhas de outono.",
        subtones: "Dourado profundo, Bronze.",
        neutrals: [
          { name: "Marrom Chocolate", hex: "#D2691E" }, { name: "Bege Quente", hex: "#F5F5DC" },
          { name: "Verde Militar", hex: "#4B5320" }, { name: "Ferrugem", hex: "#B7410E" }
        ],
        highlights: [
          { name: "Mostarda", hex: "#FFDB58" }, { name: "Laranja Queimado", hex: "#CC5500" },
          { name: "Oliva Intenso", hex: "#556B2F" }, { name: "Vermelho Tomate Escuro", hex: "#BF616A" },
          { name: "Bronze", hex: "#CD7F32" }
        ],
        makeup: { batom: "Tijolo, Cobre, Vermelho quente.", blush: "Terracota ou Bronze." },
        hair: "Ruivo intenso, Castanho acobreado, Castanho dourado.",
        avoid: "Tons frios azulados, rosa chiclete, cinza chumbo.",
        contrast_guide: "Médio. Cores ricas e saturadas (mas terrosas) funcionam bem."
      },
      "autumn_deep": {
        title: "Outono Profundo (Deep Autumn)",
        theme: "from-orange-50 to-stone-100 border-orange-200",
        accent: "text-orange-900",
        desc: "Quente neutro, profundo e nobre. Onde o calor encontra a escuridão.",
        subtones: "Oliva quente, Dourado, Quente puro.",
        neutrals: [
          { name: "Chocolate Escuro", hex: "#381819" }, { name: "Caramelo Escuro", hex: "#8A5A2E" },
          { name: "Oliva Escuro", hex: "#3C4023" }, { name: "Preto Quente", hex: "#1E1613" }
        ],
        highlights: [
          { name: "Bordô", hex: "#5A1F1F" }, { name: "Tijolo", hex: "#9A3B2E" },
          { name: "Verde Bosque", hex: "#254025" }, { name: "Dourado Velho", hex: "#B08C3A" },
          { name: "Ameixa", hex: "#4B2C3F" }
        ],
        makeup: { batom: "Vinho quente, Ameixa, Tijolo intenso.", blush: "Terracota escuro." },
        hair: "Castanho profundo quente, Chocolate com reflexos dourados.",
        avoid: "Pastéis frios, rosados frios, cinzas claros, cores neon.",
        contrast_guide: "Médio-alto. Use o claro/escuro a seu favor (profundidade)."
      },

      // ❄️ INVERNO
      "winter_bright": {
        title: "Inverno Brilhante (Bright Winter)",
        theme: "from-fuchsia-50 to-cyan-50 border-fuchsia-400",
        accent: "text-fuchsia-700",
        desc: "Frio, vibrante e elétrico. Alto contraste e cores puras definem você.",
        subtones: "Neutro-frio, Brilhante.",
        neutrals: [
          { name: "Preto Absoluto", hex: "#000000" }, { name: "Branco Puro", hex: "#FFFFFF" },
          { name: "Cinza Gelo", hex: "#EFF0F1" }, { name: "Marinho Profundo", hex: "#000080" }
        ],
        highlights: [
          { name: "Fúcsia (Pink)", hex: "#FF00FF" }, { name: "Azul Royal", hex: "#4169E1" },
          { name: "Vermelho Cereja", hex: "#DE3163" }, { name: "Verde Esmeralda", hex: "#50C878" },
          { name: "Amarelo Limão", hex: "#FAFA33" }
        ],
        makeup: { batom: "Pink vibrante, Vermelho puro, Rubi.", blush: "Rosa frio." },
        hair: "Preto azulado, Castanho escuro, Grisalho prateado.",
        avoid: "Terrosos quentes (bege, laranja, dourado), tons opacos e suaves.",
        contrast_guide: "Alto. Preto e branco juntos ficam perfeitos em você."
      },
      "winter_cool": {
        title: "Inverno Frio (True Winter)",
        theme: "from-blue-100 to-slate-100 border-blue-500",
        accent: "text-blue-800",
        desc: "Frio puro, intenso e majestoso. A rainha das neves.",
        subtones: "Azulado intenso.",
        neutrals: [
          { name: "Preto", hex: "#000000" }, { name: "Branco", hex: "#FFFFFF" },
          { name: "Cinza Aço", hex: "#4682B4" }, { name: "Marinho", hex: "#000080" }
        ],
        highlights: [
          { name: "Azul Cobalto", hex: "#0047AB" }, { name: "Roxo Real", hex: "#7851A9" },
          { name: "Rosa Choque", hex: "#FC0FC0" }, { name: "Vinho Frio", hex: "#722F37" },
          { name: "Verde Pinho", hex: "#01796F" }
        ],
        makeup: { batom: "Rosa frio, Roxo, Vinho.", blush: "Ameixa ou Rosa frio." },
        hair: "Preto azeviche, Castanho escuro frio, Grisalho branco.",
        avoid: "Dourado (use prata), laranja, marrom quente, tons amarelados.",
        contrast_guide: "Médio-alto. Mantenha a pureza e frieza das cores."
      },
      "winter_deep": {
        title: "Inverno Profundo (Deep Winter)",
        theme: "from-slate-100 to-gray-200 border-slate-500",
        accent: "text-slate-900",
        desc: "Frio neutro, profundo e misterioso. Uma intensidade noturna.",
        subtones: "Neutro-frio, Oliva escuro.",
        neutrals: [
          { name: "Preto", hex: "#000000" }, { name: "Grafite", hex: "#383838" },
          { name: "Marrom Café Frio", hex: "#4B3621" }, { name: "Azul Noite", hex: "#191970" }
        ],
        highlights: [
          { name: "Vinho Profundo", hex: "#59090C" }, { name: "Verde Floresta", hex: "#228B22" },
          { name: "Ameixa", hex: "#673147" }, { name: "Azul Marinho", hex: "#000080" },
          { name: "Vermelho Sangue", hex: "#8A0303" }
        ],
        makeup: { batom: "Vinho, Berinjela, Vermelho profundo.", blush: "Vinho ou Ameixa." },
        hair: "Preto, Castanho muito escuro, Prata escuro.",
        avoid: "Tons pastéis claros demais (te apagam), pêssego, terra claro.",
        contrast_guide: "Alto. Combine cores escuras com detalhes claros e vibrantes."
      }
    };

    // Adiciona as outras estações básicas para evitar erro de "undefined"
    const FALLBACK_DATA = SEASONAL_DATA["autumn_deep"]; // Segurança

    function getSeasonData(key) {
      // Se a estação exata existe, usa. Se não, usa Outono Profundo como base segura.
      return SEASONAL_DATA[key] || {
        ...FALLBACK_DATA,
        title: "Sua Paleta Personalizada (" + key + ")", // Mostra o nome original se faltar dados
      };
    }

    // --- FUNÇÃO DE RENDERIZAÇÃO (O CÉREBRO) ---
    /* ---------- Helper Renderers ---------- */
    function renderInventory(answers) {
      // Derive attributes from answers (simulated logic for display)
      const skinVal = answers.q11 === "A" ? { val: "Clara", temp: "Neutro-fria", chroma: "Suave" } :
        answers.q11 === "B" ? { val: "Média", temp: "Neutra", chroma: "Médio" } :
          answers.q11 === "C" ? { val: "Morena", temp: "Quente", chroma: "Intenso" } :
            { val: "Profunda", temp: "Quente/Oliva", chroma: "Intenso" };

      return `
        <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-8">
            <div class="glass-panel p-3 text-center flex flex-col items-center justify-center">
                <span class="text-2xl mb-1">🧖‍♀️</span>
                <span class="text-xs font-bold uppercase text-slate-400">Pele</span>
                <span class="text-sm font-bold text-slate-700">${skinVal.val}</span>
                <span class="text-[10px] text-slate-500">${skinVal.temp}</span>
            </div>
            <div class="glass-panel p-3 text-center flex flex-col items-center justify-center">
                <span class="text-2xl mb-1">💇‍♀️</span>
                <span class="text-xs font-bold uppercase text-slate-400">Cabelo</span>
                <span class="text-sm font-bold text-slate-700">Contraste ${answers.q3 === "A" ? "Alto" : "Médio"}</span>
            </div>
            <div class="glass-panel p-3 text-center flex flex-col items-center justify-center">
                <span class="text-2xl mb-1">👁️</span>
                <span class="text-xs font-bold uppercase text-slate-400">Olhos</span>
                <span class="text-sm font-bold text-slate-700">Brilho ${answers.q2 === "A" ? "Vivo" : "Suave"}</span>
            </div>
            <div class="glass-panel p-3 text-center flex flex-col items-center justify-center">
                <span class="text-2xl mb-1">🤨</span>
                <span class="text-xs font-bold uppercase text-slate-400">Sobrancelha</span>
                <span class="text-sm font-bold text-slate-700">Definida</span>
            </div>
            <div class="glass-panel p-3 text-center col-span-2 md:col-span-1 flex flex-col items-center justify-center bg-white/50">
                <span class="text-xs font-bold uppercase text-slate-400 mb-1">Resumo</span>
                <span class="text-xs text-slate-600 leading-tight">Sua beleza pede harmonia e repetição de temperatura.</span>
            </div>
        </div>`;
    }

    function renderComparisonGrid(currentKey, seasonData) {
      // Logic to show nearby seasons based on current
      let related = [];
      if (currentKey.includes("spring")) related = ["spring_bright", "spring_warm", "spring_light"];
      else if (currentKey.includes("summer")) related = ["summer_light", "summer_cool", "summer_soft"];
      else if (currentKey.includes("autumn")) related = ["autumn_soft", "autumn_warm", "autumn_deep"];
      else related = ["winter_bright", "winter_cool", "winter_deep"];

      return `
        <div class="seasonal-grid mt-4">
            ${related.map(k => {
        const s = SEASONAL_DATA[k];
        if (!s) return "";
        const isCurrent = k === currentKey;
        return `
                <div class="seasonal-card ${isCurrent ? 'active ring-2 ring-offset-2 ring-indigo-500' : 'opacity-70 hover:opacity-100'}">
                    <div class="text-xs font-bold uppercase mb-1 text-slate-400">${isCurrent ? 'Sua Paleta' : 'Variação'}</div>
                    <div class="h-8 w-full rounded mb-2 bg-gradient-to-r ${s.theme}"></div>
                    <h4 class="text-sm font-bold text-slate-700 leading-tight">${s.title.split('(')[0]}</h4>
                </div>
                `;
      }).join('')}
        </div>
        <p class="text-xs text-slate-500 mt-3 text-center italic">
            "Você foi classificada como ${seasonData.title.split('(')[0]} porque seu contraste e temperatura se alinham perfeitamente com os critérios desta estação."
        </p>
        `;
    }

    /* ---------- Main Render ---------- */

    function renderResult(analysis) {
      // 1) Tradução segura (não mexe nos cálculos, só no display)
      const map = {
        "Primavera Clara": "spring_light", "Primavera Quente": "spring_warm", "Primavera Brilhante": "spring_bright",
        "Verão Claro": "summer_light", "Verão Suave": "summer_soft", "Verão Frio": "summer_cool",
        "Outono Suave": "autumn_soft", "Outono Quente": "autumn_warm", "Outono Profundo": "autumn_deep",
        "Inverno Brilhante": "winter_bright", "Inverno Profundo": "winter_deep", "Inverno Frio": "winter_cool",
        // Olivas (mantém resultado original; apenas mapeia para o bloco visual)
        "Primavera Quente Oliva": "spring_warm", "Outono Quente Oliva": "autumn_warm",
        "Outono Profundo Oliva": "autumn_deep", "Verão Frio Oliva": "summer_cool",
        "Inverno Frio Oliva": "winter_cool", "Inverno Profundo Oliva": "winter_deep"
      };

      const seasonName = analysis?.final_palette?.name || "Outono Profundo";
      const seasonKey = map[seasonName] || "autumn_deep";
      const data = getSeasonData(seasonKey);
      const isOlive = String(seasonName).includes("Oliva");

      // Foto do usuário (enviada no início do fluxo)
      let userImg = state?.selfie?.dataUrl;
      if (!userImg) userImg = localStorage.getItem("colorfy_user_photo");
      if (!userImg) userImg = "https://ui-avatars.com/api/?name=Voce";

      // Define tokens dinâmicos (igual conceito do index(13))
      const a = data?.highlights?.[0]?.hex || "#782ce7";
      const b = data?.highlights?.[1]?.hex || "#0ab6ce";
      const c = data?.highlights?.[2]?.hex || "#4f46e5";
      document.documentElement.style.setProperty("--seasonA", a);
      document.documentElement.style.setProperty("--seasonB", b);
      document.documentElement.style.setProperty("--seasonC", c);

      // Rótulos rápidos (apenas UI)
      const family =
        seasonKey.includes("spring") ? "Primavera" :
          seasonKey.includes("summer") ? "Verão" :
            seasonKey.includes("autumn") ? "Outono" : "Inverno";

      const tempLabel = (data?.subtones || "").split(",")[0]?.trim() || "—";

      // Mantém o resultado como veio do backend (não recalcula nada)
      const resultTitle = data?.title || seasonName;
      const resultDesc = data?.desc || "";

      // HTML do resultado no visual do index(13), sem "Oficial" e sem seletor de estação
      const html = `
        <style>
          .cfy-premium { font-family: var(--font, "Plus Jakarta Sans","Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif); }
          .cfy-topline { color: rgba(70,84,107,.95); }
          .cfy-hero {
            border-radius: 34px;
            border: 1px solid rgba(255,255,255,.7);
            background:
              radial-gradient(900px 460px at 18% 12%, color-mix(in srgb, var(--seasonA) 20%, transparent) 0%, transparent 60%),
              radial-gradient(850px 420px at 88% 18%, color-mix(in srgb, var(--seasonB) 18%, transparent) 0%, transparent 60%),
              linear-gradient(180deg, rgba(255,255,255,.88) 0%, rgba(255,255,255,.68) 100%);
            box-shadow: 0 35px 85px rgba(20,30,50,.16);
            overflow: hidden;
            position: relative;
          }
          .cfy-hero:before {
            content:"";
            position:absolute; inset:-2px;
            background:
              conic-gradient(from 220deg at 70% 30%,
                transparent 0deg,
                color-mix(in srgb, var(--seasonA) 28%, transparent) 50deg,
                color-mix(in srgb, var(--seasonB) 22%, transparent) 110deg,
                transparent 160deg,
                color-mix(in srgb, var(--seasonC) 18%, transparent) 230deg,
                transparent 360deg);
            opacity:.75;
            filter: blur(12px);
            pointer-events:none;
          }
          .cfy-avatar {
            width: 120px; height: 120px;
            border-radius: 999px;
            border: 6px solid rgba(255,255,255,.9);
            box-shadow: 0 22px 60px rgba(20,30,50,.18);
            object-fit: cover;
            background: #fff;
          }
          .cfy-pill {
            display:inline-flex; align-items:center; gap:.45rem;
            padding: .38rem .7rem;
            border-radius: 999px;
            border: 1px solid rgba(20,30,50,.10);
            background: rgba(255,255,255,.68);
            color: #0b1020;
            font-size: .78rem;
            font-weight: 800;
            letter-spacing: .02em;
            box-shadow: 0 10px 22px rgba(20,30,50,.07);
            white-space: nowrap;
          }
          .cfy-pill strong {
            background: linear-gradient(135deg, var(--seasonA) 0%, var(--seasonB) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
          }
          .cfy-section-title {
            display:flex; align-items:center; gap:.6rem;
            font-weight: 900;
            letter-spacing: -0.02em;
            color: #111827;
          }
          .cfy-section-title:before {
            content:"";
            width: 10px; height: 26px;
            border-radius: 999px;
            background: linear-gradient(180deg, var(--seasonA), var(--seasonB));
            box-shadow: 0 10px 20px color-mix(in srgb, var(--seasonA) 18%, transparent);
          }
          .cfy-card {
            background: #fff;
            border-radius: 28px;
            border: 1px solid rgba(255,255,255, 0.55);
            box-shadow: 0 20px 40px rgba(168, 85, 247, 0.12);
          }
          .cfy-swatch {
            border-radius: 18px;
            border: 1px solid rgba(20,30,50,.10);
            background: rgba(255,255,255,.70);
            overflow: hidden;
          }
          .cfy-swatchColor { height: 56px; }
          .cfy-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
        </style>

        <div class="cfy-premium mx-auto max-w-6xl px-4 py-6 md:py-10">
          <!-- HERO (igual estilo do index(13)) -->
          <section class="cfy-hero p-6 md:p-8">
            <div class="relative z-10 grid grid-cols-1 md:grid-cols-[auto,1fr] gap-6 md:gap-8 items-center">
              <div class="flex flex-col items-center md:items-start gap-3">
                <img class="cfy-avatar" alt="Foto do usuário" src="${userImg}" />
              </div>

              <div class="text-center md:text-left">
                <div class="flex flex-wrap items-center justify-center md:justify-start gap-2 mb-3">
                  <span class="cfy-pill"><i class="fa-solid fa-leaf"></i> <strong>${family}</strong></span>
                  <span class="cfy-pill"><i class="fa-solid fa-temperature-half"></i> ${tempLabel}</span>
                  ${isOlive ? `<span class="cfy-pill"><i class="fa-solid fa-seedling"></i> <strong>Oliva</strong></span>` : ``}
                </div>

                <h1 class="text-3xl md:text-5xl font-black tracking-tight leading-[1.05] mb-3">
                  Sua paleta é <span class="bg-clip-text text-transparent" style="background-image: linear-gradient(135deg, var(--seasonA), var(--seasonB), var(--seasonC));">${resultTitle}</span>
                </h1>
                <p class="text-base md:text-lg font-semibold cfy-topline" style="line-height:1.6; max-width: 60ch;">
                  ${resultDesc}
                </p>

                <div class="mt-5 grid grid-cols-1 sm:grid-cols-3 gap-3">
                  <div class="cfy-card p-4">
                    <div class="text-xs font-extrabold uppercase" style="color: rgba(90,104,124,.95); letter-spacing:.12em;">Subtons</div>
                    <div class="mt-1 text-lg font-black" style="color:#0b1020;">${data?.subtones || "—"}</div>
                  </div>
                  <div class="cfy-card p-4">
                    <div class="text-xs font-extrabold uppercase" style="color: rgba(90,104,124,.95); letter-spacing:.12em;">Cabelo</div>
                    <div class="mt-1 text-sm font-bold" style="color:#0b1020;">${data?.hair || "—"}</div>
                  </div>
                  <div class="cfy-card p-4">
                    <div class="text-xs font-extrabold uppercase" style="color: rgba(90,104,124,.95); letter-spacing:.12em;">Evitar</div>
                    <div class="mt-1 text-sm font-bold" style="color:#0b1020;">${data?.avoid || "—"}</div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- PALETAS -->
          <section class="mt-8 cfy-card p-5 md:p-6">
            <h2 class="cfy-section-title text-xl md:text-2xl mb-4">Paleta principal</h2>

            <div class="mb-6">
              <div class="text-xs font-extrabold uppercase mb-3" style="color: rgba(90,104,124,.95); letter-spacing:.12em;">Neutros essenciais</div>
              <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                ${(data?.neutrals || []).map(c => `
                  <button type="button" class="cfy-swatch text-left p-3 hover:opacity-95 transition" onclick="navigator.clipboard.writeText('${c.hex}').catch(()=>{});">
                    <div class="cfy-swatchColor rounded-xl" style="background:${c.hex};"></div>
                    <div class="mt-2 text-sm font-extrabold">${c.name}</div>
                    <div class="cfy-mono text-xs" style="color: rgba(70,84,107,.95);">${c.hex}</div>
                  </button>
                `).join("")}
              </div>
            </div>

            <div>
              <div class="text-xs font-extrabold uppercase mb-3" style="color: rgba(90,104,124,.95); letter-spacing:.12em;">Cores de destaque</div>
              <div class="grid grid-cols-2 sm:grid-cols-5 gap-3">
                ${(data?.highlights || []).map(c => `
                  <button type="button" class="cfy-swatch text-left p-3 hover:opacity-95 transition" onclick="navigator.clipboard.writeText('${c.hex}').catch(()=>{});">
                    <div class="cfy-swatchColor rounded-xl" style="background:${c.hex};"></div>
                    <div class="mt-2 text-sm font-extrabold">${c.name}</div>
                    <div class="cfy-mono text-xs" style="color: rgba(70,84,107,.95);">${c.hex}</div>
                  </button>
                `).join("")}
              </div>
            </div>
          </section>

          <!-- MAKEUP -->
          <section class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="cfy-card p-5 md:p-6">
              <h2 class="cfy-section-title text-xl mb-3">Maquiagem</h2>
              <div class="space-y-3">
                <div class="cfy-swatch p-4">
                  <div class="text-xs font-extrabold uppercase" style="color: rgba(90,104,124,.95); letter-spacing:.12em;">Batom</div>
                  <div class="mt-1 font-bold">${data?.makeup?.batom || "—"}</div>
                </div>
                <div class="cfy-swatch p-4">
                  <div class="text-xs font-extrabold uppercase" style="color: rgba(90,104,124,.95); letter-spacing:.12em;">Blush</div>
                  <div class="mt-1 font-bold">${data?.makeup?.blush || "—"}</div>
                </div>
              </div>
            </div>

            <div class="cfy-card p-5 md:p-6">
              <h2 class="cfy-section-title text-xl mb-3">Contraste</h2>
              <div class="cfy-swatch p-4">
                <div class="text-sm font-bold" style="line-height:1.6; color: rgba(70,84,107,.98);">
                  ${data?.contrast_guide || "—"}
                </div>
              </div>

              <div class="mt-4">
                <button type="button" class="neu-btn primary w-full" onclick="window.print()">
                  <i class="fa-solid fa-print mr-2"></i>Salvar / Imprimir
                </button>
              </div>
            </div>
          </section>

          <div class="mt-8 text-center text-xs" style="color: rgba(90,104,124,.92);">
            Sessão: <span class="cfy-mono">${state?.session_id || localStorage.getItem("colorfy_pending_session") || "—"}</span>
          </div>
        </div>
      `;

      const container = document.getElementById("resultContainer");
      if (!container) {
        console.error("Erro Crítico: Elemento 'resultContainer' não encontrado no HTML.");
        return;
      }

      container.innerHTML = html;
    }


    /* ---------- Analysis Pipeline (Demo) ---------- */
    const loadingMsgs = [
      "Calculando temperatura (quente/fria/oliva) e profundidade…",
      "Cruzando respostas com critérios de desempate (esclera/íris/rubor)…",
      "Organizando paleta em neutros + destaques e combinações prontas…",
      "Preparando relatório prático para roupas, maquiagem, cabelo e acessórios…"
    ];

    async function runAnalysisPipeline() {
      // Loading messages
      let i = 0;
      $("#loadingMsg").textContent = loadingMsgs[0];
      const interval = setInterval(() => {
        i = (i + 1) % loadingMsgs.length;
        $("#loadingMsg").textContent = loadingMsgs[i];
      }, 1600);

      try {
        // Salva a imagem localmente para recuperar na volta do pagamento
        if (state.selfie.dataUrl) {
          try {
            localStorage.setItem("colorfy_user_photo", state.selfie.dataUrl);
          } catch (e) {
            console.warn("Foto muito grande para salvar localmente", e);
          }
        }

        // Prepare payload (clean base64)
        // state.selfie.dataUrl looks like "data:image/jpeg;base64,/9j/4AAQSk..."
        const base64Clean = state.selfie.dataUrl.split(",")[1];

        const payload = {
          user: state.user,
          quizAnswers: state.quiz.answers,
          image: {
            base64: base64Clean
          }
        };

        // Call API
        const response = await fetch('/api/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          const err = await response.json();
          throw new Error(err.error || "Falha na comunicação com o servidor");
        }

        const data = await response.json();

        clearInterval(interval);

        // Scanner view (visual feedback)
        goTo("view-scanner");
        $("#scanImg").src = state.selfie.dataUrl;

        // Força um tempo mínimo de leitura biométrica (UX dramática)
        // Aumentamos de 2500ms para 3000ms para o usuário apreciar o HUD
        await sleep(3000);

        // Save analysis from Backend
        // state.analysis = data.final; // No longer receiving 'final' directly here

        // Render result
        // renderResult(state.analysis); // Postpone rendering

        // INTERCEPTED: Go to checkout instead of result
        // Use the session_id returned by backend
        // Use the session_id returned by backend
        if (data.session_id) {
          // Backup session to local storage in case URL params are lost
          state.session_id = data.session_id;
          localStorage.setItem('colorfy_pending_session', data.session_id);

          window.location.href = `Checkout.html?session_id=${data.session_id}`;
        } else {
          throw new Error("Sessão inválida recebida do servidor.");
        }

        // goTo("view-checkout"); // Not a view, but a redirect
        // goTo("view-result"); // original

      } catch (err) {
        clearInterval(interval);
        console.error(err);
        alert("Erro na análise: " + err.message + "\n\nVerifique se o servidor ('npm start') está rodando.");
        goTo("view-upload"); // go back
      }
    }

    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    function demoVisualFeatures(a) {
      // Demo heuristics based on a few answers
      const skin_value = (a.q11 === "A") ? "Clara" : (a.q11 === "B") ? "Média clara" : (a.q11 === "C") ? "Média/morena" : "Profunda";
      const temp = computePreTemperature() === "cool" ? "Fria (tendência)" : "Quente (tendência)";
      const contrast = (a.q3 === "B") ? "Médio-alto (recorte de íris nítido)" : "Médio (transição suave)";
      const croma = (a.q2 === "A") ? "Mais vivo (esclera clara)" : "Mais suave (esclera off-white)";
      return {
        skin_value,
        skin_temperature: temp,
        skin_croma: croma,
        contrast_level: contrast,
        observations: [
          "Leitura visual combinada com respostas técnicas.",
          "Contraste e valor usados para refinamento final.",
          "Resultado validado por critérios de desempate."
        ]
      };
    }

    /* ---------- Build Report ---------- */
    function buildReport(palette, category, name, answers) {
      const techNote = `Classificação baseada em leitura combinada (selfie + questionário).
A paleta "${palette}" apresentou maior coerência com contraste, valor e resposta ao subtom.`;

      const feature_inventory = {
        "Temperatura predominante": category === "warm" ? "Quente / Oliva" : "Fria / Oliva",
        "Valor da pele": answers.q11 === "A" ? "Pele clara" :
          answers.q11 === "B" ? "Pele média" :
            answers.q11 === "C" ? "Pele morena" : "Pele profunda",
        "Contraste": answers.q3 === "B" ? "Médio-alto" : "Médio",
        "Resposta ao sol": answers.q9 || "—"
      };

      const main_palette = paletteColors(palette);

      return {
        sections: {
          technical_note: techNote,
          feature_inventory,
          seasonal_classification: `Sua classificação principal é ${palette}.`,
          main_palette,
          best_combinations: [
            "Neutros da paleta combinados com 1 cor de destaque",
            "Contraste moderado entre topo e base",
            "Texturas naturais (tecidos foscos ou acetinados)"
          ],
          use_with_moderation: [
            "Cores fora da paleta principal",
            "Contrastes extremos (preto puro vs branco puro)",
            "Tons acinzentados fora da família"
          ],
          contrast_management:
            "Prefira contrastes médios. Evite extremos muito duros se o rosto perder definição.",
          real_world_style: {
            roupas: "Use a paleta como base para peças próximas ao rosto.",
            maquiagem: "Base neutra compatível com subtom; blush e batom da paleta.",
            cabelo: "Reflexos e tonalizações dentro da família cromática."
          },
          advanced_techniques: [
            "Blocos de cor em áreas estratégicas",
            "Repetição de cor próxima ao rosto",
            "Equilíbrio entre cor e textura"
          ],
          comparison_grid: main_palette,
          trend_adaptation: [
            "Adapte tendências usando tons equivalentes da sua paleta",
            "Evite seguir tendências fora da sua família cromática"
          ],
          next_steps: [
            "Salve sua paleta",
            "Teste combinações no guarda-roupa",
            "Use como guia para compras futuras"
          ],
          quick_summary: `${name}, sua paleta ${palette} valoriza sua aparência de forma consistente e elegante.`
        }
      };
    }

    /* ---------- Palette Helpers ---------- */
    function paletteColors(palette) {
      const maps = {
        "Primavera Quente": ["#FFB703", "#FB8500", "#FFD166", "#EF476F", "#06D6A0", "#118AB2", "#073B4C", "#F1FAEE"],
        "Primavera Quente Oliva": ["#C9CF7A", "#908E17", "#FFBF69", "#F4A261", "#E9C46A", "#6A994E", "#386641", "#FFF1C8"],
        "Outono Quente": ["#B87333", "#E05E16", "#A44A3F", "#6F1D1B", "#BC6C25", "#DDA15E", "#FEFAE0", "#432818"],
        "Outono Quente Oliva": ["#525834", "#908E17", "#A98467", "#6C584C", "#ADC178", "#DDA15E", "#F0EAD2", "#3A5A40"],
        "Outono Profundo": ["#4A0F24", "#3E1F47", "#7F5539", "#6A040F", "#9D0208", "#370617", "#03071E", "#FFE5D9"],
        "Verão Frio": ["#C48793", "#9E8BB5", "#B5838D", "#6D6875", "#E5989B", "#BEE1E6", "#EDF2FB", "#F8F9FA"],
        "Verão Frio Oliva": ["#5A514B", "#80766E", "#C8B8AA", "#A5A58D", "#B7B7A4", "#DDBEA9", "#F5EBE0", "#3A5A40"],
        "Inverno Frio": ["#7B1E3A", "#003B44", "#1D3557", "#457B9D", "#E63946", "#F1FAEE", "#0B132B", "#5BC0BE"],
        "Inverno Frio Oliva": ["#3A5A40", "#344E41", "#588157", "#A3B18A", "#DAD7CD", "#2F3E46", "#1B263B", "#415A77"]
      };
      return maps[palette] || ["#EDF0F6", "#DDE3F0", "#C8D0E7", "#AAB6D9", "#8E9AC8", "#6F7EB5", "#5565A3", "#3D4D91"];
    }

    /* ---------- Render Result (Cinematic & Orchestrated) ---------- */
    // Função renderResult substituída pela nova versão acima.


    function fillList(sel, arr) {
      const ul = $(sel);
      ul.innerHTML = "";
      arr.forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        ul.appendChild(li);
      });
    }

    /* ---------- Orbits ---------- */
    function renderOrbits(colors) {
      const layer = $("#orbitLayer");
      layer.innerHTML = "";
      const radius = 140;
      colors.forEach((c, i) => {
        const orb = document.createElement("div");
        orb.className = "color-orb";
        orb.style.background = c.hex || c;
        const angle = (i / colors.length) * Math.PI * 2;
        const x = Math.cos(angle) * radius;
        const y = Math.sin(angle) * radius;
        orb.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
        layer.appendChild(orb);
      });
    }

    /* ---------- Audit / Download ---------- */
    function downloadResultPDF() {
      // Ensure result view is visible for printing
      const prevView = document.querySelector(".view-section.active")?.id;
      goTo("view-result");
      window.scrollTo(0, 0);

      // Restore previous view after print
      window.addEventListener("afterprint", () => {
        if (prevView && prevView !== "view-result") goTo(prevView);
      }, { once: true });

      // Give the browser a tick to paint the result view
      setTimeout(() => window.print(), 80);
    }

    $("#btnShowAudit")?.addEventListener("click", (ev) => {
      // Shift+click keeps the old "audit" behavior for debugging
      if (ev.shiftKey) {
        $("#auditBlock").style.display = "block";
        return;
      }
      downloadResultPDF();
    });
    $("#btnHideAudit")?.addEventListener("click", () => $("#auditBlock").style.display = "none");

    /* ---------- Checkout Logic (New) ---------- */
    /* ---------- Checkout Logic (New) ---------- */

    async function proceedToResult() {
      const sessionId =
        state.session_id || localStorage.getItem("colorfy_pending_session");

      if (!sessionId) {
        alert("Sessão não encontrada. Faça a análise novamente para continuar.");
        goTo("view-landing");
        return;
      }

      try {
        const res = await fetch("/api/create-checkout", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ session_id: sessionId })
        });

        const data = await res.json();

        if (!res.ok || !data.url) {
          console.error(data);
          alert("Não foi possível iniciar o checkout. Tente novamente.");
          return;
        }

        window.location.href = data.url; // ✅ redireciona para Stripe Checkout
      } catch (err) {
        console.error(err);
        alert("Erro ao abrir checkout. Verifique sua conexão e tente novamente.");
      }
    }

    // Botões que levam ao checkout Stripe
    $("#btnCheckoutTop")?.addEventListener("click", proceedToResult);
    $("#btnCheckoutHero")?.addEventListener("click", proceedToResult);
    $("#btnCheckoutOffer")?.addEventListener("click", proceedToResult);
    $("#btnCheckoutBottom")?.addEventListener("click", proceedToResult);

    // Botão da tela de pagamento pendente
    $("#btnBackToCheckout")?.addEventListener("click", proceedToResult);


    /* ---------- Session Recovery (Checkout Return) ---------- */


    /* ---------- Initialization & Session Recovery ---------- */

    // =========================================================
    // LÓGICA DE RECUPERAÇÃO DE SESSÃO E INICIALIZAÇÃO BLINDADA
    // =========================================================

    // =========================================================
    // CORREÇÃO DEFINITIVA DO FLUXO DE PAGAMENTO (Auto-Retry)
    // =========================================================

    async function checkPaymentAndLoadResult(sessionId, { showPendingView = true } = {}) {
      if (!sessionId) return false;

      // Salva sessão para persistência (caso o usuário atualize a página)
      state.session_id = sessionId;
      localStorage.setItem('colorfy_pending_session', sessionId);

      // Garante que a tela de loading esteja visível
      const currentView = document.querySelector(".view-section.active")?.id;
      if (currentView !== "view-result" && currentView !== "view-payment-pending") {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById('view-loading').classList.add('active');
      }

      try {
        const res = await fetch(`/api/get-result?session_id=${encodeURIComponent(sessionId)}`);

        // CASO 1: PAGAMENTO PENDENTE (402)
        // O webhook ainda não processou. Retornamos TRUE para manter o usuário esperando.
        if (res.status === 402) {
          if (showPendingView) {
            const pendingMsg = document.getElementById("pendingMsg");
            if (pendingMsg) pendingMsg.textContent = "Pagamento em processamento. Aguarde...";
            goTo("view-payment-pending");
          }
          return true; // IMPORTANTE: Retorna true para NÃO redirecionar para a home
        }

        // CASO 2: ERRO TÉCNICO
        if (!res.ok) {
          console.warn("API retornou status:", res.status);
          return false;
        }

        // CASO 3: SUCESSO (200)
        const data = await res.json();
        if (data.ok && data.paid && data.result) {
          state.analysis = data.result;
          state.user = data.result.user || state.user;

          renderResult(state.analysis);
          goTo("view-result");

          localStorage.removeItem('colorfy_pending_session');
          return true;
        }

        return false;
      } catch (err) {
        console.error("Erro na verificação:", err);
        return false;
      }
    }

    async function initApp() {
      const params = new URLSearchParams(window.location.search);
      const urlSessionId = params.get('session_id'); // ID vindo do Stripe
      const localSessionId = localStorage.getItem('colorfy_pending_session');

      const sessionId = urlSessionId || localSessionId;

      if (sessionId) {
        // Tenta verificar o pagamento
        const handled = await checkPaymentAndLoadResult(sessionId, { showPendingView: true });

        // --- A MÁGICA ACONTECE AQUI ---
        // Se temos um ID na URL (acabou de voltar do Stripe), NUNCA vá para a home.
        // Se a API falhou ou está pendente, tentamos de novo em 3 segundos.
        if (urlSessionId) {
          if (!handled || document.getElementById('view-payment-pending').classList.contains('active')) {
            // Atualiza mensagem de loading
            const msgEl = document.getElementById("loadingMsg");
            if (msgEl) msgEl.textContent = "Confirmando pagamento... (Isso pode levar alguns segundos)";

            // Tenta novamente em 3 segundos (Polling)
            setTimeout(() => initApp(), 3000);
          }
          return; // <--- IMPEDE O REDIRECIONAMENTO (ERRO CORRIGIDO)
        }

        // Se for apenas refresh e deu certo, ok.
        if (handled) return;
      }

      // Inicialização padrão (só vai para Home se realmente não tiver sessão)
      const current = document.querySelector(".view-section.active")?.id;
      if (!current || current === "view-loading") {
        goTo("view-landing");
      }
    }

    // Inicializa o App
    window.addEventListener("load", initApp);
    function resetAll() {
      location.reload();
    }

    /* ---------- Extreme Interaction System (Scripts) ---------- */

    document.addEventListener("DOMContentLoaded", () => {
      // 1. Parallax Background
      const parallaxOrbs = document.querySelectorAll(".layer-1");

      document.addEventListener("mousemove", (e) => {
        if (!parallaxOrbs.length) return;
        const x = (e.clientX / window.innerWidth) - 0.5;
        const y = (e.clientY / window.innerHeight) - 0.5;

        // Move Layer 1 (Orbs) slower
        parallaxOrbs.forEach(el => {
          el.style.transform = `translate(${x * 30}px, ${y * 30}px)`;
        });
      });

      // 2. Magnetic Buttons
      const magnets = document.querySelectorAll(".magnet-btn");
      magnets.forEach(btn => {
        btn.addEventListener("mousemove", (e) => {
          const rect = btn.getBoundingClientRect();
          const x = e.clientX - rect.left - rect.width / 2;
          const y = e.clientY - rect.top - rect.height / 2;

          btn.style.transform = `translate(${x * 0.4}px, ${y * 0.4}px) scale(1.05)`;
        });

        btn.addEventListener("mouseleave", () => {
          btn.style.transform = "translate(0, 0) scale(1)";
        });
      });

      // 3. Liquid Button (Follow Cursor Internal)
      const liquids = document.querySelectorAll(".btn-liquid");
      liquids.forEach(btn => {
        btn.addEventListener("mousemove", (e) => {
          const rect = btn.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          // Move the pseudo-element 'blob' via CSS variables if we update CSS
          // For now, based on provided CSS, it's a simple hover fill. 
          // To make it follow x/y, we'd need to update the CSS to use var(--x), var(--y).
          // Enhancing CSS on the fly for liquid effect:
          const blob = btn.querySelector('.liquid-blob'); // If we had one
          // Current CSS implementation in step 451 uses ::before with top/left transition.
          // Let's make it smarter:
          btn.style.setProperty('--x', x + 'px');
          btn.style.setProperty('--y', y + 'px');
        });
      });
      // 4. Scroll Reveal (Intersection Observer)
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('in-view');
          }
        });
      }, { threshold: 0.1 });

      document.querySelectorAll('.flowCard').forEach(el => observer.observe(el));

      // 5. Active Focus (Steps)
      window.addEventListener('scroll', () => {
        const cards = document.querySelectorAll('.flowCard');
        if (!cards.length) return;

        const center = window.innerHeight / 2;
        let closest = null;
        let minDiff = Infinity;

        cards.forEach(card => {
          const rect = card.getBoundingClientRect();
          const cardCenter = rect.top + rect.height / 2;
          const diff = Math.abs(center - cardCenter);

          if (diff < minDiff) {
            minDiff = diff;
            closest = card;
          }
        });

        cards.forEach(card => {
          if (card === closest && minDiff < 300) { // Only focus if reasonably close to center
            card.classList.add('focused');
            card.classList.remove('blurred');
          } else {
            card.classList.remove('focused');
            card.classList.add('blurred');
          }
        });
      }, { passive: true });

      // 6. Haptic Feedback (Mobile)
      const interactives = document.querySelectorAll('button, a, .flowCard, .card-oliva-premium, .seasonal-card, .star');
      interactives.forEach(el => {
        el.addEventListener('pointerdown', () => { // pointerdown is faster than click
          if (navigator.vibrate) navigator.vibrate(15);
        });
      });
    });


  </script>
</body>

</html>